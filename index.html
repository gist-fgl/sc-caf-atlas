<!DOCTYPE html>
<html lang="en">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WP2MK0GG5F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WP2MK0GG5F');
</script>
<head>
    <!-- Required meta tags (add the responsive viewport meta tag) -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="Single Cell CAF Atlas Web Application">
    <title>Single Cell CAF Atlas</title>
    
    <!--Bootstrap CSS library-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <!--Google Icon CSS library-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- JS -->
    <!--For Using utility functions-->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js"></script>
    <script> lodash = _.noConflict(); // load script of lodash </script> 
    <!--Plotly-->
    <script src="https://cdn.plot.ly/plotly-1.57.1.min.js"></script>
    <!--For loading large csv files-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.2.0/papaparse.min.js"></script>
    <!--Python's Numpy-like Library, NumJS-->
    <script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
    <!--D3 to draw tables-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <!--chroma to draw colormaps-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
    <!--hotkeys to add keyboard shortcuts-->
    <script src="https://cdn.jsdelivr.net/npm/hotkeys-js@3.8.1/dist/hotkeys.min.js" integrity="sha256-4nmnbhmVpr2Rg64+7ysAr93+vQrfc0UvHWwm4W6uXJM=" crossorigin="anonymous"></script>
    
    <!--Datatable for efficient visualization of tabular data-->
    <!--full: jquery.dataTables.js, jquery.dataTables.css-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <!-- dataframe.js for useful dataframe functions -->
    <script src="https://cdn.jsdelivr.net/npm/dataframe-js@1.4.3/dist/dataframe.min.js" integrity="sha256-ncD0rnpkULRQhB+hFzhFCQ4KBu+NKVYEQHyhxsUA29Q=" crossorigin="anonymous"></script>
    <!-- FileSaver.js to save js object as local files -->
    <script src="https://cdn.jsdelivr.net/npm/filesaver.js@1.3.4/FileSaver.min.js" integrity="sha256-5IjlS/EkXaEXRrVOMusSOlmQsyFy3DvCD5QC5mJZubU=" crossorigin="anonymous"></script>
    <!-- Html2Canvas.js to save current view as a PNG file -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js" integrity="sha256-Ax1aqtvxWBY0xWND+tPZVva/VQZy9t1Ce17ZJO+NTRc=" crossorigin="anonymous"></script>
    <!-- Pako.js to parse base64 gzipped text file downloaded from remote location -->
    <script src="https://cdn.jsdelivr.net/npm/pako@1.0.11/dist/pako.min.js" integrity="sha256-Kc+gVCuYZLZkDP3MjxWxhNtkMbUy2ycCo86X5fKn/Bw=" crossorigin="anonymous"></script>
    <!-- Bootstrap-Toggle.js for responsive toggle button -->
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
<!--   Tagify for search bar interaction   -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify@3.21.5/dist/tagify.css" integrity="sha256-JQCBuvZzuXrKFdHRTVW23P/DqnFsfvbI3kraGJhPyNA=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify@3.21.5/dist/tagify.min.js" integrity="sha256-6QmUlbXKkm+RVqvqtIzhhDQ3cqRkuREeUhNJDnL2ujM=" crossorigin="anonymous"></script>
<!--   vis-network.js for graph visualization   -->
     <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    
<!--  Font Awesome    -->
    <script src="https://kit.fontawesome.com/b773d81884.js" crossorigin="anonymous"></script>
<!--     <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="css/github__pro_sidebar-jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" href="css/github__pro_sidebar-main.css">
    <link rel="stylesheet" href="css/github__pro_sidebar-sidebar-themes.css">
    
<!--  for responsive sidebar (from https://github.com/azouaoui-med/pro-sidebar-template)    -->
    
    <style>
      * { box-sizing: border-box; }
        /* Create two equal columns that floats next to each other */
        .column {
          float: left;
          width: 50%;
          padding: 10px;
          height: 450px; /* Should be removed. Only for demonstration */
          position:relative;
        }
        /* Clear floats after the columns */
        .responsive_row_with_two_columns:after {
          float:left;
          content: "";
          display: table;
          clear: both;
        }
        /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 700px) {
          .column {
            width: 100%;
          }
        }
        .deconstructed_pancake_box { /* example in https://web.dev/one-line-layouts/ */
            flex: 1 1 450px;
            margin: 5px;
        }
        .deconstructed_pancake_parent {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .container_molstar {
          height: 600px; /* Should be modified */
          position:relative;
        }
        #container_d3_table_metrics{
          display: grid;
          grid-template-rows: auto 1fr auto;
          position:relative;
        }
        #plotly_graph_molecular_mimicry_map{
            float:left;
            width:100%;
            padding: 5px;
            height:575px;
            position:relative;
            overflow:hidden;
        }
        .graph_for_selection{
            float:left;
            width:100%;
            height:350px;
            position:relative;
        }
/*    custom bootstrap button color   */
        .bg-custom-navbar{  /* custom navbar color and gradient for secondary navbar */
            background-image: linear-gradient( 45deg, #d11100 0%, #fccf53 100%);
        }
        .bg-custom-navbar-secondary{  /* custom navbar color and gradient */
            background-image: linear-gradient( 15deg, #46137a 0%, #f08dee 100%);
        }
        .bg-custom-navbar-hidden{  /* custom navbar color and gradient */
            border-left: 6px solid #ccc;
            border-bottom: 3px solid #ccc;
            color: #000;
            border-color: #942200;
            background-color: #f8f7fa;
/*             '#fce6ff; #dfdae6; #f3f0f7; */
        }
        .bg-custom-navbar-top{  /* custom navbar color and gradient (color representing lupus awareness color) */
            background-image: linear-gradient( 0deg, #ababab 0%, #f7f7f7 100%);
        }
        /* CSS for D3 Table */
        table { border-collapse: collapse; color: #333; background-color: #F7F6F3; margin: auto; } /* place the table in the middle of div */
        table thead { font-weight: bold; background-color: #CCC; cursor: default; text-align: center; }
        table tbody tr:hover { background-color: #FFC; }
        td { border: solid 1px #CCC; padding: 0 1ex; }
        .table_even { color: #284775; background-color: White; }
        .table_left { text-align: left; }
        .table_center { text-align: center; }
        .table_right { text-align: right; }
        .table_add { color: green; }
        .table_minus { color: red; }

/*     for tidy organization of buttons     */
        .btn { 
            margin-bottom: 0px !important;
        }
        .helpIcon
        {
          cursor: pointer;
          padding-top:12px;
        }
        i.icon-white {
            color: white;
            display:inline-flex;
            vertical-align:middle;
        }
        i.icon-black {
            color: black;
            display:inline-flex;
            vertical-align:middle;
        }
        /* for labeled buttons */
        .btn-label {position: relative;left: -12px;display: inline-block;padding: 6px 12px;background: rgba(0,0,0,0.1);border-radius: 3px 0 0 3px;}
        .btn-labeled {padding-top: 0;padding-bottom: 0;}
        .btn { margin-bottom:10px; }
        /* for  div. displayed during loading (https://stackoverflow.com/questions/54439548/display-loading-symbol-while-waiting-for-a-result-with-plot-ly-dash) */
        @keyframes fadein {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 0.5;
            }
        }
        ._plotly-loading-callback {
          font-family: sans-serif;
          padding-top: 50px;
          color: rgb(90, 90, 90);

          /* The banner */
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          text-align: center;
          cursor: progress;

          opacity: 0;
          background-color: rgb(250, 250, 250);
          /* Delay animation by 1s to prevent flashing 
             and smoothly transition the animation over 0.5s 
           */
          -moz-animation: fadein 0.5s ease-in 1s forwards; /* Firefox */
          -webkit-animation: fadein 0.5s ease-in 1s forwards; /* Safari and Chrome */
          -o-animation: fadein 0.5s ease-in 1s forwards; /* Opera */
            animation: fadein 0.5s ease-in 1s forwards;
        }
        /* Add an extra .carousel parent class to increase specificity
           avoiding the use of !important flag. */
        .carousel-caption {
            color: black;
        }
        .carousel .carousel-indicators li {
            background-color: #fff;
            background-color: rgba(70, 70, 70, 0.25);
        }

        .carousel .carousel-indicators .active {
            background-color: #444;
        }
        .carousel .carousel-indicators li {
            background-color: #fff;
            background-color: rgba(70, 70, 70, 0.25);
        }

        .carousel .carousel-indicators .active {
            background-color: #444;
        }
        .carousel-control-next,
        .carousel-control-prev {
            filter: invert(100%);
        }
        /* for loading SVG images */
/*         .loader{
          margin: 0 0 2em;
          height: 100px;
          width: 100%;
          text-align: center;
          padding: 1em;
          margin: 0 auto 1em;
          display: inline-block;
          vertical-align: top;
        } */
/*  https://gitbrent.github.io/bootstrap4-toggle/ custom settings  */
          .toggle.ios, .toggle-on.ios, .toggle-off.ios { border-radius: 20rem; height: 35px !important; }
          .toggle.ios .toggle-handle { border-radius: 20rem; height: 35px !important; }
/* twitter typeahead css */
        .tt-query {
          -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
             -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
                  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
        }
        .tt-hint {
          color: #999
        }
        .tt-menu {    /* used to be tt-dropdown-menu in older versions */
          width: 422px;
          margin-top: 4px;
          padding: 4px 0;
          background-color: #fff;
          border: 1px solid #ccc;
          border: 1px solid rgba(0, 0, 0, 0.2);
          -webkit-border-radius: 4px;
             -moz-border-radius: 4px;
                  border-radius: 4px;
          -webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
             -moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);
                  box-shadow: 0 5px 10px rgba(0,0,0,.2);
        }
        .tt-suggestion {
          padding: 3px 20px;
          line-height: 24px;
        }
        .tt-suggestion.tt-cursor,.tt-suggestion:hover {
          color: #fff;
          background-color: #0097cf;

        }
        .tt-suggestion p {
          margin: 0;
        }
/*     deconstructed pancake     */
        .deconstructed_pancake__parent {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .deconstructed_pancake__box {
            flex: 1 1 750px;
            margin: 10px;
        }
        
/* sidebar button (for small window) */
        #button_open_sidebar { /* CSS for Scroll Back To Top Button */
          display: none; /* Hidden by default */
          position: fixed; /* Fixed/sticky position */
          top: 25px; /* Place the button at the bottom of the page */
          right: 30px; /* Place the button 30px from the right */
          z-index: 9999; /* Make sure it does not overlap */
          outline: none; /* Remove outline */
          border-width: 1px;
          border-color: #b53b16;
          background-color: #f56c42; /* Set a background color */
          color: white; /* Text color */
          cursor: pointer; /* Add a mouse pointer on hover */
          padding: 15px; /* Some padding */
          border-radius: 50%; /* Rounded corners */
          font-size: 18px; /* Increase font size */
        }
        #button_open_sidebar:hover {
          background-color: #cc6216 ; /* Indigo Add a dark-grey background on hover */
        }
        
/*     custom css on Pro Sidebar (https://github.com/azouaoui-med/pro-sidebar-template)  */
        
#mynetwork {
  width: 600px;
  height: 400px;
  border: 1px solid lightgray;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen",
    "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue",
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, "Courier New",
    monospace;
}
    </style>
    <!-- icon of the document -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%3E%3Ctext%20x='0'%20y='16'%20style='filter:%20invert(100%);'%3E🦠%3C/text%3E%3C/svg%3E" type="image/svg+xml" />
</head>
    
<body>
    
<!-- where captured current view is stored as a data URL  -->
<a id="anchor-current-view" href="#" hidden></a>
    <div id='container_main_sidebar' class="page-wrapper light-theme border-radius-on sidebar-bg bg1 toggled">
        <nav id="sidebar" class="sidebar-wrapper">
            <div class="sidebar-content">
                <!-- sidebar-brand  -->
<!--                 <div class="sidebar-item sidebar-brand">
                    <a href="#">Single Cell lncRNA Atlas</a>
                </div> -->
                <!-- sidebar-header  -->
<!--                 <div class="sidebar-item sidebar-header d-flex flex-nowrap">
                </div> -->
                <!-- sidebar-search  -->
<!--                 <div class="sidebar-item sidebar-search">
                    <div>
                        <div class="input-group">
                            <input name='tags' id='searchbox_cell_cluster' placeholder='Search Cell Cluster' value='' data-blacklist='.NET,PHP'>
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div> -->
                <!-- sidebar-menu  -->
                <div class=" sidebar-item sidebar-menu">
                    <ul>
                        <li class="header-menu">
                            <span>Change UMAP Coordinates</span>
                        </li>
                        <li class="sidebar-dropdown">
                            <a href="#">
                                <i class="fas fa-compress"></i>
                                <span class="menu-text">Sub-Clustering</span>
                            </a>
                            <div class="sidebar-submenu">
                                <ul>
                                    <li>
                                        <a href="#" onclick="Change_UMAP_Coordinate( 'All' )">All Cells<span class="badge badge-pill badge-primary">838,388 cells</span></a>
                                    </li>
<!--                                     <li>
                                    <li>
                                        <a href="#" onclick="Change_UMAP_Coordinate( 'Heart' )">Heart<span class="badge badge-pill badge-primary">5979 cells</span></a>
                                    </li>
                                    <li>
                                        <a href="#" onclick="Change_UMAP_Coordinate( 'Intestine' )">Intestine<span class="badge badge-pill badge-primary">2330 cells</span></a>
                                    </li>
                                    <li>
                                        <a href="#" onclick="Change_UMAP_Coordinate( 'Kidney' )">Kidney<span class="badge badge-pill badge-primary">2455 cells</span></a>
                                    </li>
                                    <li>
                                        <a href="#" onclick="Change_UMAP_Coordinate( 'Lung' )">Lung<span class="badge badge-pill badge-primary">4375 cells</span></a>
                                    </li>
                                    <li>
                                        <a href="#" onclick="Change_UMAP_Coordinate( 'Liver' )">Liver<span class="badge badge-pill badge-primary">4191 cells</span></a>
                                    </li>
                                    <li>
                                        <a href="#" onclick="Change_UMAP_Coordinate( 'Thymus' )">Thymus<span class="badge badge-pill badge-primary">2914 cells</span></a>
                                    </li> -->
                                </ul>
                            </div>
                        </li>
                        <li class="header-menu">
                            <span>Graphs</span>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa-solid fa-location-pin"></i>
                                <span class="menu-text" data-toggle="collapse" data-target="#container_panel_sclncrna_expression_violin" aria-expanded="false" aria-controls="container_panel_datatable_cell_marker">Violin Plot</span>
                            </a>
                        </li>
                        <li class="header-menu">
                            <span>Data Table</span>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-viruses"></i>
                                <span class="menu-text" data-toggle="collapse" data-target="#container_panel_datatable_cell_marker" aria-expanded="false" aria-controls="container_panel_datatable_cell_marker">Cell Type Markers</span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fas fa-chart-line"></i>
                                <span class="menu-text" data-toggle="collapse" data-target="#container_panel_datatable_correl" aria-expanded="false" aria-controls="container_panel_datatable_correl">Co-expression</span>
                            </a>
                        </li>
<!--                         <li class="header-menu">
                            <span>Extra</span>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-book"></i>
                                <span class="menu-text">Documentation</span>
                                <span class="badge badge-pill badge-primary">Beta</span>
                            </a>
                        </li> -->
                        <li class="header-menu">
                            <span>Pin sidebar</span>
                        </li>
                        <li>
                            <a id="pin-sidebar" class="btn btn-light" href="#">
                                <span><i class="fas fa-thumbtack"></i></span>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- sidebar-menu  -->
            </div>
            <!-- sidebar-footer  -->
<!--             <div class="sidebar-footer">
                <div class="dropdown">

                    <a href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-bell"></i>
                        <span class="badge badge-pill badge-warning notification">3</span>
                    </a>
                    <div class="dropdown-menu notifications" aria-labelledby="dropdownMenuMessage">
                        <div class="notifications-header">
                            <i class="fa fa-bell"></i>
                            Notifications
                        </div>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">
                            <div class="notification-content">
                                <div class="icon">
                                    <i class="fas fa-check text-success border border-success"></i>
                                </div>
                                <div class="content">
                                    <div class="notification-detail">Lorem ipsum dolor sit amet consectetur adipisicing
                                        elit. In totam explicabo</div>
                                    <div class="notification-time">
                                        6 minutes ago
                                    </div>
                                </div>
                            </div>
                        </a>
                        <a class="dropdown-item" href="#">
                            <div class="notification-content">
                                <div class="icon">
                                    <i class="fas fa-exclamation text-info border border-info"></i>
                                </div>
                                <div class="content">
                                    <div class="notification-detail">Lorem ipsum dolor sit amet consectetur adipisicing
                                        elit. In totam explicabo</div>
                                    <div class="notification-time">
                                        Today
                                    </div>
                                </div>
                            </div>
                        </a>
                        <a class="dropdown-item" href="#">
                            <div class="notification-content">
                                <div class="icon">
                                    <i class="fas fa-exclamation-triangle text-warning border border-warning"></i>
                                </div>
                                <div class="content">
                                    <div class="notification-detail">Lorem ipsum dolor sit amet consectetur adipisicing
                                        elit. In totam explicabo</div>
                                    <div class="notification-time">
                                        Yesterday
                                    </div>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-center" href="#">View all notifications</a>
                    </div>
                </div>
                <div class="dropdown">
                    <a href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-envelope"></i>
                        <span class="badge badge-pill badge-success notification">7</span>
                    </a>
                    <div class="dropdown-menu messages" aria-labelledby="dropdownMenuMessage">
                        <div class="messages-header">
                            <i class="fa fa-envelope"></i>
                            Messages
                        </div>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">
                            <div class="message-content">
                                <div class="pic">
                                    <img src="img/user.jpg" alt="">
                                </div>
                                <div class="content">
                                    <div class="message-title">
                                        <strong> Jhon doe</strong>
                                    </div>
                                    <div class="message-detail">Lorem ipsum dolor sit amet consectetur adipisicing
                                        elit. In totam explicabo</div>
                                </div>
                            </div>

                        </a>
                        <a class="dropdown-item" href="#">
                            <div class="message-content">
                                <div class="pic">
                                    <img src="img/user.jpg" alt="">
                                </div>
                                <div class="content">
                                    <div class="message-title">
                                        <strong> Jhon doe</strong>
                                    </div>
                                    <div class="message-detail">Lorem ipsum dolor sit amet consectetur adipisicing
                                        elit. In totam explicabo</div>
                                </div>
                            </div>

                        </a>
                        <a class="dropdown-item" href="#">
                            <div class="message-content">
                                <div class="pic">
                                    <img src="img/user.jpg" alt="">
                                </div>
                                <div class="content">
                                    <div class="message-title">
                                        <strong> Jhon doe</strong>
                                    </div>
                                    <div class="message-detail">Lorem ipsum dolor sit amet consectetur adipisicing
                                        elit. In totam explicabo</div>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item text-center" href="#">View all messages</a>

                    </div>
                </div>
                <div class="dropdown">
                    <a href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-cog"></i>
                        <span class="badge-sonar"></span>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuMessage">
                        <a class="dropdown-item" href="#">My profile</a>
                        <a class="dropdown-item" href="#">Help</a>
                        <a class="dropdown-item" href="#">Setting</a>
                    </div>
                </div>
                <div>
                    <a href="#">
                        <i class="fa fa-power-off"></i>
                    </a>
                </div>
                <div class="pinned-footer">
                    <a href="#">
                        <i class="fas fa-ellipsis-h"></i>
                    </a>
                </div>
            </div> -->
        </nav>
        <!-- page-content  -->
<main class="page-content">
<div id="overlay" class="overlay"></div>
<!-- start of the current view container -->
<div id="application-current-view"> 
<div id="single_cell_lncrna_database">
    <nav class="navbar navbar-expand-lg navbar-dark bg-custom-navbar"> <!-- sticky-top -->
        <a class="navbar-brand mb-0 h1" href="https://gist-fgl.github.io/sc-caf-atlas/">Single Cell Cancer Associated Fibroblast Atlas</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav_top" aria-controls="navbarNav_top" aria-expanded="false" aria-label="Toggle top navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarNav_top">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" type="button" data-toggle="collapse" data-target="#introduction" aria-controls="introduction" aria-expanded="false" aria-label="Toggle introduction" onclick="Toggle_Introduction_Modal( )">Introduction</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="documentation/index.html">Documentation</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" type="button" aria-label="Toggle Side Menu" id="toggle-sidebar">Side Menu</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link">Citation</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link">Feedback</a>
                </li>
                <li class="nav-item">
                    <select class="custom-select w-auto mx-2 my-0" id="select_dataset" title="select dataset" onchange="Load_Dataset( )">
                        <option value="all">838,388 cells (full dataset)</option>
                        <option value="10000cells_per_cluster">290,523 cells (1/3 subsampled)</option>
                        <option value="5000cells_per_cluster">158,943 cells (1/5 subsampled)</option>
                        <option value="2000cells_per_cluster" selected>66,741 cells (1/12 subsampled)</option>
                        <option value="1000cells_per_cluster">34,647 cells (1/25 subsampled)</option>
                    </select>
                </li>
            </ul>

<!--             <li class="nav-item">
                <div class="form-check form-check-inline" id="toggle_alignment_mode_container">
                    <input id="toggle_alignment_mode" type="checkbox" checked data-toggle="toggle" data-on="Alignment to Virus" data-off="Alignment to Human" data-onstyle="secondary" data-offstyle="light" data-style="ios" data-width="14rem" data-height="calc(1.5em + .75rem + 2px)" onchange="Load_Dataset( )">
                </div>
            </li>-->

            
            <button type="button" class="btn btn-light bth-sm ml-auto mr-1 my-0" aria-label="capture current view and download it as a PNG file" data-tooltip="tooltip" data-placement="left" data-html="true" title="Capture <b>current view</b> and download it as a PNG file" onclick="DownloadCurrentView( )"><i class="material-icons icon-black" style="font-size:25px">camera_alt</i></button>
            <button type="button" class="btn btn-light bth-sm ml-1 mr-1 my-0" aria-label="show keyboard shortcuts" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to show <b>keyboard shortcuts</b>" onclick="$( '#modal_keyboard_shortcuts' ).modal( 'show' )"><i class="material-icons icon-black" style="font-size:25px">keyboard</i></button>
            <button type="button" class="btn btn-light bth-sm ml-1 my-0" aria-label="toggle tooltips" data-tooltip-always-active="tooltip" data-placement="bottom" data-html="true" title="Press to <b>on/off</b> help messages on mouse over (hover) of certain buttons" onclick="Toggle_Tooltips( )"><i class="material-icons icon-black" style="font-size:25px">help_outline</i></button>
        </div>
    </nav>
    <button onclick="Toggle_Sidebar( )" id="button_open_sidebar" title="Open Sidebar"><i class="fas fa-sliders-h"></i></button>
    <div id="container_single_cell_scatter_plot">
        <div id="controlBox_plotly_graph_main">
            <div class="pos-f-t">
                <nav class="navbar navbar-dark bg-custom-navbar">
                    <form class="form-inline">
                        <button class="navbar-toggler mr-auto" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent__plotly_graph_umap" aria-controls="navbarToggleExternalContent__plotly_graph_umap" aria-expanded="false" aria-label="Toggle navigation" data-tooltip="tooltip" data-placement="right" data-html="true" title="Press to change main graph settings"><i class="material-icons icon-white" style="font-size:20px;cursor:pointer">settings</i></button>
                        <a class="mb-0" style="color:white; font-size:0.8em" id="text_number_of_records"></a>
                    </form>
                    
                    <form class="form-inline mx-auto">
                        <div class="input-group-prepend mx-2 my-0" style="height:30px"><h5 id="text_umap_annotation" class="input-group-text">Annotation</h5></div>
                        <select class="form-control my-0" id="select_umap_annotation_data" style="text-align: center; height:30px; line-height: 0px; padding-top: 0px; padding-bottom: 0px;" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Select data to be visualized on the 'Annotation' UMAP plot" onchange="ChangeAnnotation( )">
                            <option value="name_cluster" selected>Cluster</option>
                            <option value="cell_type">Cell Type</option>
                            <option value="tissue">Tissue</option>
                            <option value="nCount_RNA">Number of mRNA</option>
                            <option value="nFeature_RNA">Number of Genes</option>
                            <option value="percent_mt">MT Percentage</option>
                            <option value="gender">Biological Sex</option>
                            <option value="disease">Disease Name</option>
                            <option value="cancer_stage">Cancer Stage</option>
                            <option value="sampling_site">Sampling Site</option>
                            <option value="group">Cell Group</option>
                        </select>
<!--                         <button class="btn btn-light btn-sm mx-2 my-0" type="button" data-toggle="button" data-tooltip="tooltip" data-placement="left" data-html="true" title="Press to <b>on/off</b> the <i>legend</i> of the graph" id="button_toggle_legend_UMAP" onclick="Toggle_Legend_UMAP( )"><i class="fas fa-list"></i></button> -->
                    </form>
                    <form class="form-inline mx-auto">
                        <div class="input-group-prepend mx-2 my-0 my-0" style="height:30px"><h5 id="text_umap_expression_x" class="input-group-text">X</h5></div>
                        <select class="form-control my-0" id="select_scatter_x_axis" style="text-align: center; height:30px; line-height: 0px; padding-top: 0px; padding-bottom: 0px;" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Select X-axis of scatter plots. When selecting 'Gene', click a gene of interest in the list of gene symbol tags in the search box to set the expression of the given gene as the axis." onchange="Change_UMAP_Coordinate( null );">
                            <option value="__UMAP__" selected>UMAP-1</option>
                            <option value="Gene">Gene</option>
<!--                             <option value="Scatter">Scatter</option> -->
                        </select>
                        <div class="input-group-prepend mx-2 my-0 my-0" style="height:30px"><h5 id="text_umap_expression_y" class="input-group-text">Y</h5></div>
                        <select class="form-control my-0" id="select_scatter_y_axis" style="text-align: center; height:30px; line-height: 0px; padding-top: 0px; padding-bottom: 0px;" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Select Y-axis of scatter plots. When selecting 'Gene', click a gene of interest in the list of gene symbol tags in the search box to set the expression of the given gene as the axis." onchange="Change_UMAP_Coordinate( null );">
                            <option value="__UMAP__" selected>UMAP-2</option>
                            <option value="Gene">Gene</option>
<!--                             <option value="Scatter">Scatter</option> -->
                        </select>
<!--                         <button class="btn btn-light btn-sm mx-2 my-0" type="button" data-toggle="button" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>on/off</b> the <i>legend</i> of the graph" id="button_umap_expr_left" onclick=""><i class="fas fa-caret-up"></i></button> -->
<!--                         <button class="btn btn-light btn-sm my-0" type="button" data-toggle="button" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>on/off</b> the <i>legend</i> of the graph" id="button_umap_expr_right" onclick=""><i class="fas fa-caret-down"></i></button> -->
                    </form>
                </nav>
                <div class="collapse" id="navbarToggleExternalContent__plotly_graph_umap">
                    <div class="bg-custom-navbar-hidden p-4">
                        <h4 class="text-black">Main Graph Setting Panel</h4>
                        <p>
                            <h5 class="text-muted">General Setting</h5>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="input-group mx-2 my-2">
                                    <div class="input-group-prepend"><span class="input-group-text">Plot height is</span></div>
                                    <input type="text" class="form-control" aria-label="height of the plot in pixel" id="input_plot_height_UMAP" title="input field for setting the height of UMAP plots in pixels" value="1100">
                                    <div class="input-group-append"><span class="input-group-text">pixels</span></div>
                                </div>
                            </div>
                        </p>
                        <p>
                            <h5 class="text-muted">Violin Plot Setting</h5>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="input-group mx-2 my-2">
                                    <div class="input-group-prepend"><span class="input-group-text">Plot height is</span></div>
                                    <input type="text" class="form-control" aria-label="height of the plot in pixel" id="input_plot_height_violin" title="input field for setting the height of violin plots in pixels" value="1100">
                                    <div class="input-group-append"><span class="input-group-text">pixels</span></div>
                                </div>
                            </div>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="input-group">
                                    <div class="form-check form-check-inline">
                                        <input id="checkbox__plotly_sclncrna_expression_violin__ignore_cells_with_zero_counts" type="checkbox" checked data-toggle="toggle" data-on="All Cells" data-off="Only Positive Cells" data-onstyle="light" data-offstyle="secondary" data-size="sm" data-style="ios" data-width="150" onchange="UpdateGene( )">
                                    </div>
                                </div>
                            </div>
                        </p>
                        <p><button type="button" class="btn btn-secondary btn-block mx-2 my-2" onclick="UpdateGene( );PlotCellAnnotation( );">Update Graphs</button></p>
                    </div>
                </div>
            </div>
        </div> 
        <div id="container_main_panel">
            <div id="container_searchbox_main">
                <input name='tags' id='searchbox_main' placeholder='Enter Gene Symbol' value='' data-blacklist='.NET,PHP'>
            </div>
            <div id="container_plotly_searchbox_main_preview_container" style="position:relative">
                <div id="container_plotly_searchbox_main_preview" class="collapse" style="position:absolute; z-index:990; left:0; top:0;">
                    <div id="plotly_searchbox_main_preview"></div>
                </div>
            </div>
            <div class="deconstructed_pancake__parent">
                <div class="deconstructed_pancake__box"><div id="plotly_sclncrna_expression_umap_annotation"></div></div>
                <div class="deconstructed_pancake__box"><div id="plotly_sclncrna_expression_umap_expression"></div></div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-dark bg-custom-navbar">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent_supplementary_graph_setting_panel" aria-controls="navbarToggleExternalContent_supplementary_graph_setting_panel" aria-expanded="false" aria-label="Toggle supplementary plot setting panel" data-tooltip="tooltip" data-placement="right" data-html="true" title="Press to <b>select or remove columns</b> in for <i>parallel coordinate graphs</i> for filtering cross-reactivity prediction data"><i class="material-icons icon-white" style="font-size:20px;cursor:pointer">settings</i></button>
        <form class="form-inline">
			<button class="btn btn-light btn-sm mx-1 my-0" id="btn_violin_plot" type="button" data-toggle="collapse" data-toggle="button" data-target="#container_panel_sclncrna_expression_violin" aria-expanded="false" aria-controls="container_panel_sclncrna_expression_violin" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> <i>a collection of violin plots</i> displaying a distribution of gene expression values for each cell cluster" aria-label="">Violin Plot</button>
            <button class="btn btn-light btn-sm mx-1 my-0" id="btn_cell_marker_table" type="button" data-toggle="collapse" data-toggle="button" data-target="#container_panel_datatable_cell_marker" aria-expanded="false" aria-controls="container_panel_datatable_cell_marker" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> <i>a data table</i> displaying <b>cell markers</b> for a given cell cluster" aria-label="">Cell Marker Table</button>
            <button class="btn btn-light btn-sm mx-1 my-0" id="btn_correl_gene_table" type="button" data-toggle="collapse" data-toggle="button" data-target="#container_panel_datatable_correl" aria-expanded="false" aria-controls="container_panel_datatable_correl" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> <i>a data table</i> displaying a list of genes <b>whose expression is correlated with the current gene</b>" aria-label="">Co-expressed Gene Table</button>
<!--             <button class="btn btn-light btn-sm mx-1 my-0" type="button" data-toggle="collapse" data-toggle="button" data-target="#container_interaction_network" aria-expanded="false" aria-controls="container_interaction_network"data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> <i>a table</i> showing <b>predicted/experimental structural properties</b> of aligned query and SARS-CoV-2 target proteins" aria-label="">Interactions</button> -->
        </form>
    </nav>
    <div class="collapse" id="navbarToggleExternalContent_supplementary_graph_setting_panel">
        <div class="bg-custom-navbar-hidden p-4">
            <h4 class="text-black">Supplementary Graph Setting Panel</h4>
        </div>
    </div>
    <div id="container_panel_sclncrna_expression_violin" class="collapse">
        <div id="plotly_sclncrna_expression_violin"></div>
    </div>
    <div id="container_panel_datatable_cell_marker" class="collapse">
        <nav class="navbar navbar-dark bg-custom-navbar">
            <a class="navbar-brand mb-0 h5" id="panel_name_cellmarker">Cell Marker Table</a>
            <div class="btn-toolbar" role="toolbar">
                <div class="input-group mr-2 ml-1 my-0">
                    <div class="input-group-append"><span class="input-group-text">Download Data</span></div>
                </div>
                <button class="btn btn-light ml-1 mr-2 my-0" type="button" onclick="Download_DataTable( 'datatable_cell_marker' )" data-tooltip="tooltip" data-placement="bottom" title="Press to download current datatable as a CSV file"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">get_app</i></button> 
            </div>
            <button type="button" class="close" aria-label="Close container_panel_datatable_cell_marker" data-toggle="collapse" data-target="#container_panel_datatable_cell_marker"><span aria-hidden="true">&times;</span></button>
        </nav>
        <div id="container_datatable_cell_marker"><table id="datatable_cell_marker" class="display" width="100%"></table></div>
    </div>
    <div id="container_panel_datatable_correl" class="collapse">
        <nav class="navbar navbar-dark bg-custom-navbar">
            <a class="navbar-brand mb-0 h5" id="panel_name_correl_gene">Co-expression Table</a>
            <div class="btn-toolbar" role="toolbar">
                <div class="input-group mr-2 ml-1 my-0">
                    <div class="input-group-append"><span class="input-group-text">Download Data</span></div>
                </div>
                <button class="btn btn-light ml-1 mr-2 my-0" type="button" onclick="Download_DataTable( 'datatable_correl' )" data-tooltip="tooltip" data-placement="bottom" title="Press to download current datatable as a CSV file"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">get_app</i></button> 
            </div>
            <button type="button" class="close" aria-label="Close container_panel_datatable_correl" data-toggle="collapse" data-target="#container_panel_datatable_correl"><span aria-hidden="true">&times;</span></button>
        </nav>
        <div id="container_datatable_correl"><table id="datatable_correl" class="display" width="100%"></table></div>
    </div>
<!--     <div id="container_interaction_network" class="collapse">
        <nav class="navbar navbar-dark bg-custom-navbar">
            <a class="navbar-brand mb-0 h5">Data Tables</a>
            <div class="btn-toolbar" role="toolbar">
                <div class="input-group mr-2 ml-1 my-0">
                    <select class="custom-select w-auto" id="select_datatable" title="select datatable">
                        <option value="B-cell cross-reactivity prediction">select datatable</option>
                        <option value="B-cell cross-reactivity prediction" selected>B-cell cross-reactivity prediction</option>
                        <option value="T-cell cross-reactivity prediction">T-cell cross-reactivity prediction</option>
                        <option value="query proteins">query proteins</option>
                        <option value="target proteins">target proteins</option>
                        <option value="MHC alleles">MHC alleles</option>
                    </select>
                    <div class="input-group-append"><span class="input-group-text">datatable</span></div>
                </div>
                <button type="button" class="btn btn-light mx-0 my-0" id="button_display_datatable" aria-pressed="false" onclick="Display_DataTable( )" autocomplete="off">Show</button>
                <button class="btn btn-light ml-1 mr-2 my-0" type="button" onclick="Download_DataTable( )" data-tooltip="tooltip" data-placement="bottom" title="Press to download current datatable as a CSV file"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">get_app</i></button> 
            </div>
            <button type="button" class="close" aria-label="Close container_interaction_network" data-toggle="collapse" data-target="#container_interaction_network"><span aria-hidden="true">&times;</span></button>
        </nav>
        <div id="interaction_network" style="height:100px;">
            <div>
                <h1>lncRNA Interaction Graphs</h1>
                <label>
                  Filter nodes
                  <select id="nodeFilterSelect">
                    <option value>All characters</option>
                    <option value="kid">kids</option>
                    <option value="adult">adults</option>
                    <option value="male">male</option>
                    <option value="female">female</option>
                  </select>
                </label>
                <br />
                <br />
                <label>
                  Filter edges
                  <div>
                    <label>
                      <input type="checkbox" name="edgesFilter" value="parent" checked />
                      Is <span style="color: green">parent</span> of
                    </label>
                  </div>
                  <div>
                    <label>
                      <input type="checkbox" name="edgesFilter" value="teacher" checked />
                      Is <span style="color: blue">teacher</span> of
                    </label>
                  </div>
                  <div>
                    <label>
                      <input type="checkbox" name="edgesFilter" value="friend" checked />
                      Is <span style="color: red">friend</span> of
                    </label>
                  </div>
                </label>
                <br />
                <div id="mynetwork"></div>
            </div>
        </div>
    </div> -->

    

</div>
</div> 
<!-- end of current view container -->
</main>
<!-- page-content" -->
</div>


<div class="modal fade" id="modal_keyboard_shortcuts" tabindex="-1" role="dialog" aria-labelledby="modal_keyboard_shortcuts" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="label_modal_generate_peptides">Keyboard Shortcuts</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <h5 class="text-muted mb-2" style="font-size:20px">General</h5>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>s</kbd><b>(screenshot)</b> to capture <b>the current view</b> and download it as a PNG file</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>i</kbd><b>(introduction)</b> to toggle the introduction and instructions</p>
				<p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>t</kbd><b>(introduction)</b> to toggle the sidebar menu</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>h</kbd><b>(help messages)</b> to toggle tooltip messages that are shown when mouse pointers are on buttons.</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>u</kbd><b>(UP)</b> to move to the top of the page.</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>d</kbd><b>(Down)</b> to move to the bottom of the page.</p>
                <br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Okay</button>
            </div>
        </div>
    </div>
</div>
<!-- fullscreen introduction modal -->
<div id="modal_introduction" class="modal fade show" tabindex="-1" role="dialog" aria-labelledby="modal_introduction" aria-hidden="true" style="padding-right: 0px!important;"> <!-- disable fading when the web page has been loaded -->
  <div class="modal-dialog" style="width: 100%!important;height: 100%!important;margin: 0!important;padding: 0!important;max-width:none !important;">
    <div class="modal-content" style="height: auto !important; min-height: 100% !important; border-radius: 0 !important;min-width: 100% !important;">
        <nav class="navbar navbar-expand-lg navbar-dark bg-custom-navbar"> <!-- sticky-top -->
            <a class="navbar-brand mb-0 h1" href="https://gist-fgl.github.io/sc-caf-atlas/">Single Cell Cancer Associated Fibroblast Atlas</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav_top" aria-controls="navbarNav_top" aria-expanded="false" aria-label="Toggle top navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav_top">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="documentation/index.html">Documentation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link">Citation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link">Feedback</a>
                    </li>
                </ul>
            </div>
        </nav>
            <div class="modal-header">
                <h1 class="modal-title">Introduction</h1>
                <button class="btn btn-link btn-lg mt-2 mr-auto" onclick="Toggle_Introduction_Modal();">Skip Introduction</button>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <h2></h2>
                
                <h2></h2>
				
				
				<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="https://gist-fgl.github.io/sc-caf-atlas/img/website1.svg" class="d-block w-100 mx-auto" style="max-width: 1700px; max-height: 900px  !important;" alt="samples and tissues">
<!--                             <div class="carousel-caption d-none d-md-block">
                                <h2>Explore cross-reactive immune epitopes</h2>
                                <p>Toggle <b>help messages</b> by pressing <kbd>Cmd</kbd> + <kbd>H</kbd><br>Keyboard shorcuts can be found at the upper right corner</p>
                            </div> -->
                        </div>
                        <div class="carousel-item">
                            <img src="https://gist-fgl.github.io/sc-caf-atlas/img/website2.svg" class="d-block w-100 mx-auto" style="max-width: 1700px; max-height: 900px !important;" alt="clusters">
<!--                             <div class="carousel-caption d-none d-md-block">
                                <h2>Explore cross-reactive immune epitopes</h2>
                                <p>Zoom in/out to explore cross-reactive immune epitopes on the specific region of a human/virus protein</p>
                            </div> -->
                        </div>
                        <div class="carousel-item">
                            <img src="https://gist-fgl.github.io/sc-caf-atlas/img/website3_compressed.jpg" class="d-block w-100 mx-auto" style="max-width: 700px; max-height: 900px !important;" alt="broad cell types">
<!--                             <div class="carousel-caption d-none d-md-block">
                                <h2>Filter cross-reactive immune epitopes</h2>
                                <p>Multiple filters can be applied.<br>To remove a filter, click the filter again</p>
                            </div> -->
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
				
                <!-- <img src="img/abstract.jpg" alt="introduction images" style="min-width:50%;max-width:90%;display: block;margin-left: auto;margin-right: auto;"> -->
                <br>
                <div class="card mx-auto my-2" style="max-width: 60rem;">
                    <div class="card-body">
                        <h2 class="card-title">Abstract</h2>
                        <p class="card-text">Cancer-associated fibroblasts (CAFs) are the dominating component of stroma in the tumor microenvironment (TME) and influence the cancer hallmarks through interacting with other components. However, systematic characterization of the heterogeneity and dynamics of CAF across different cancer types is lacking. Here, we performed pan-cancer analysis to profile TME at single-cell resolution with 234 samples from 10 types of solid cancer, revealing the most prolific interactions of CAF with other TME components and the distinct CAF composition patterns with specific expression of marker genes and transcription factors.</p>
                    </div>
<!--                     <div class="mr-auto ml-auto"><a style="font-size: 1.35em; font-weight: bold" target="_blank" rel="noopener noreferrer" class="btn btn-link btn-sm mx-1 my-0" role="button" data-toggle="button" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Click to view our BioRXiv preprint">BioRXiv preprint<i class="material-icons icon-black" style="font-size: 0.9em">launch</i></a></div> -->
                </div>

<!--                 <h1 class="modal-title">Usages</h1> -->

                <h5 class="text-muted" style="text-align:center;">The web application has been developed by Hyunsu An at Gwangju Institute of Science and Technology under the supervision of Professor JiHwan Park.</h5>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary btn-lg btn-block" data-dismiss="modal">Start!</button>
            </div>
        </div>
    </div>
</div>
<div id="loading_screen"></div>

<script src="js/github__pro_sidebar-jquery.mCustomScrollbar.concat.min.js"></script>
<script src="js/github__pro_sidebar-main.js"></script>
    
<script>
// packages
var DragSort=function(t){
    var e,i=0,s={},r={},a=(e=window.MutationObserver||window.WebKitMutationObserver,function(t,i){t&&1===t.nodeType&&(e?new e((function(t,e){i(t)})).observe(t,{childList:!0,subtree:!1}):window.addEventListener&&t.addEventListener("DOMNodeInserted",i,!1))});function n(t,e){if(!t)return this;e=e||{},this.parentElm=t,this.uid=e.uid,this.settings={selector:"*",callbacks:{}},Object.assign(this.settings,e),this.setup(),a(this.parentElm,this.setup.bind(this)),this.bindEvents()}return n.prototype={namespace:"dragsort",setup(){[...this.parentElm.childNodes].forEach(t=>{if(1!=t.nodeType)return t.parentNode.removeChild(t);t.matches(this.settings.selector)&&(t.draggable=!0)}),this.gap=this.getItemsGap(this.parentElm.firstElementChild)},throttle(t,e){var i=!1,s=this;return function(r){i||(t.call(s,r),i=!0,setTimeout(()=>i=!1,e))}},getDraggableElm(t){var e=t.closest('[draggable="true"]');return this.uid==s.uid?e:null},dragstart(t,e){s=this;var i,r=this.getDraggableElm(e);r?(this.source=this.getInitialState(),this.target=this.getInitialState(),i=r.getBoundingClientRect(),this.source.elm=r,this.source.idx=this.getNodeIndex(r),this.source.size.width=i.width,this.source.size.height=i.height,t.dataTransfer.effectAllowed="move",setTimeout(this.afterDragStart.bind(this))):s={}},afterDragStart(){var t="vertical"==this.settings.mode?"height":"width";this.parentElm.classList.add(this.namespace+"--dragStart"),this.source.elm.style[t]=this.source.size[t]+"px",this.source.elm.classList.add(this.namespace+"--dragElem")},dragover(t){t.preventDefault(),t.stopPropagation();var e=t.target;if((e=this.getDraggableElm(e))&&this.target){var i=this.target.elm,s=this.target.hoverDirection;t.dataTransfer.dropEffect="move",this.target.hoverDirection=this.getTargetDirection(t),i==e&&s==this.target.hoverDirection||this.directionAwareDragEnter(t,e)}},dragenter(t,e){(e=this.getDraggableElm(e))&&this.target&&this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(this.target.bounding=e.getBoundingClientRect())},directionAwareDragEnter(t,e){var i;t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="none",this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(t.dataTransfer.dropEffect="move",this.cleanupLastTarget(),this.target.elm=e,this.target.idx=this.getNodeIndex(e),e.classList.add("over"),i=Math.abs(this.target.idx-this.source.idx),this.source.elm.classList.toggle(this.namespace+"--hide",i>0),"vertical"==this.settings.mode?this.target.elm.style[this.target.hoverDirection?"marginBottom":"marginTop"]=this.source.size.height+this.gap+"px":this.target.elm.style[this.target.hoverDirection?"marginRight":"marginLeft"]=this.source.size.width+this.gap+"px")},dragend(t){if(clearTimeout(this.dragoverTimeout),this.dragoverTimeout=null,this.parentElm.classList.remove(this.namespace+"--dragStart"),!this.isValidElm(this.target.elm))return this.cleanup();var e=this.target.hoverDirection?this.target.elm.nextElementSibling:this.target.elm;return this.source.elm!=this.target.elm&&this.target.elm&&(this.target.elm.classList.add(this.namespace+"--noAnim"),this.cleanup(),this.parentElm.insertBefore(this.source.elm,e)),this.source.elm&&this.source.elm.classList.remove(this.namespace+"--dragElem",this.namespace+"--hide"),this.settings.callbacks.dragEnd(this.source.elm),this},isTargetLastChild(){return this.parentElm.lastElementChild==this.target.elm},getTargetDirection(t){if(this.target.bounding)return"vertical"==this.settings.mode?t.pageY>this.target.bounding.top+this.target.bounding.height/2?1:0:t.pageX>this.target.bounding.left+this.target.bounding.width/2?1:0},getNodeIndex(t){for(var e=0;t=t.previousSibling;)3==t.nodeType&&/^\s*$/.test(t.data)||e++;return e},isValidElm(t){return t&&t.nodeType&&t.parentNode==this.parentElm},cleanup(){s={},[...this.parentElm.children].forEach(t=>{t.removeAttribute("style"),setTimeout(()=>{t.classList.remove(this.namespace+"--over",this.namespace+"--noAnim",this.namespace+"--dragElem")},50)})},cleanupLastTarget(){this.target.elm&&(this.target.elm.classList.remove(this.namespace+"--hide",this.namespace+"--over"),this.target.elm.removeAttribute("style"))},getInitialState:()=>({elm:null,size:{}}),getItemsGap(t){var e=getComputedStyle(t);return"vertical"==this.settings.mode?parseInt(e.marginTop)+parseInt(e.marginBottom):parseInt(e.marginLeft)+parseInt(e.marginRight)},bindEvents(t){for(var e in this.listeners=this.listeners||{dragstart:t=>this.dragstart(t,t.target),dragenter:t=>this.dragenter(t,t.target),dragend:t=>this.dragend(t,t.target),dragover:this.throttle(this.dragover,350)},this.listeners)this.parentElm[t?"removeEventListener":"addEventListener"](e,this.listeners[e])},destroy(){this.cleanup(),this.bindEvents(!0),delete r[this.uid]}},function(t,e){return r[++i]=t._DragSort?r[t._DragSort]:new n(t,{...e,uid:i}),t._DragSort=i,r[i]}}();

// Initialization
    var name_application = "Single_Cell_LncRNA_Database"; // define name of the application
    $(document).ready( function( ) {
        $('[data-toggle="tooltip"]').tooltip( ); // enable tooltips
        $('[data-tooltip="tooltip"]').tooltip( );
        $('[data-tooltip-always-active="tooltip"]').tooltip( );
        $( '#modal_introduction' ).modal( 'show' ); // show introduction modal
        Toggle_Tooltips( ); // set tooltips status
        Initialize( );
    });
    var object_data = { }; // an object containing data
    object_data.file = { }; 
    object_data.file.base_url = "current/rawdata/base64/";
    object_data.file.dict_name_file_to_parsed_data = { };
    object_data.main = { };
    object_data.main.gene = { };
    object_data.setting = { };
    object_data.setting.plot = { };
    object_data.flags = { };
    async function Load_Dataset( ) {
        return new Promise( async function( resolve, reject ) { 
            // load dataset 
            let name_adata = Select_Get_Selected_Option_Using_ID( 'select_dataset' ).value;
            console.log( "[Load_Dataset] loading data for ", name_adata );
            object_data.main.name_adata = name_adata; // update the name of the current data
            // for faster async loading, the data files will be loaded together
            var l_remote_file = [ "current/rawdata/base64/box_precomputed.multiplied_by_1000.cell_type.tsv.gz.base64.txt",
                                "current/rawdata/base64/cell_marker.index.tsv.gz.base64.txt",
                                "current/rawdata/base64/cells." + name_adata + ".tsv.gz.base64.txt",
                                "current/rawdata/base64/expr." + name_adata + ".multiplied_by_1000.index.tsv.gz.base64.txt" ];
            await LoadRemoteData( l_remote_file ); // load remote core data 
            
            object_data.main.int_num_cells = object_data.file.dict_name_file_to_parsed_data[ "cells." + name_adata + ".tsv.gz.base64.txt" ].cell_barcode.length // update the number of cells in the current dataset
            int_size_ResponsiveMarkerSize = Math.max( Math.min( 5, parseInt( 350000 / object_data.main.int_num_cells ) ), 2 ); // set the size of markers responsively
            await ParseData( );
            
            // plot graph
            await Change_UMAP_Coordinate( 'All' )
            
            console.log( "[Load_Dataset] resolved" );
            Loading_Screen( false );
            resolve( "[Load_Dataset] resolved" );
        });
    }
    async function Initialize( ) { // initialize the web application
        // initlaize the current gene_symbol ('Load_Dataset' currently requires initialization of an input gene)
        object_data.main.gene.gene_symbol = 'MYL9';
        await Load_Dataset( ); // load dataset
        console.log( "[Initialize] core data loaded", Object.keys( object_data.file.dict_name_file_to_parsed_data ) );
//         console.log( "[Initialize] processing of parsed data completed:", Object.keys( object_data.file.dict_name_file_to_parsed_data ) );
        Initialize_SearchBox_Main( );
//         Initialize_SearchBox_CellCluster( );
        console.log( "[Initialize] the main Gene_Symbol search box is now ready to receive queries", Object.keys( object_data.file.dict_name_file_to_parsed_data ) );
        // load data for previewing gene expression
        // visualize one gene as an example
        PreviewGene( object_data.main.gene.gene_symbol );
        tagify_searchbox_main.addTags( 'MYL9' )
        Loading_Screen( false );
    }    
  
// Bootstrap component control
    var flag_tooltip_active_Toggle_Tooltips = true;
    function Toggle_Tooltips(  ) {
        console.log( "[Toggle_Tooltips] Tooltips toggled to ", flag_tooltip_active_Toggle_Tooltips )
        flag_tooltip_active_Toggle_Tooltips = ! flag_tooltip_active_Toggle_Tooltips; // toggle the flag
        if ( flag_tooltip_active_Toggle_Tooltips ) { $('[data-tooltip="tooltip"]').tooltip( 'enable' ); }
        else { $('[data-tooltip="tooltip"]').tooltip( 'disable' ); }
    }
// load packages
    // use dataframe-js
    var DataFrame = dfjs.DataFrame;
    
// key interactions
    object_data_keydown = { dict_status: { } };
    function Record_KeyDown( event ) { // Record pressed keyborad keys, and trigger appropriate function when key is pressed.
        object_data_keydown.dict_status[ event.key ] = event.type; // record event.type for each key
    }
    window.addEventListener( "keyup", Record_KeyDown );
    window.addEventListener( "keypress", Record_KeyDown );
    window.addEventListener( "keydown", Record_KeyDown );
    hotkeys( 'ctrl+d,ctrl+i,ctrl+u,ctrl+h,command+h,command+d,command+i,command+u', function ( event, handler ) {
        event.preventDefault( );
        switch ( handler.key ) {
            case 'ctrl+s': 
            case 'command+s': 
                DownloadCurrentView( ); 
                break;
            case 'ctrl+t': 
            case 'command+t': 
                Toggle_Sidebar( ); 
            case 'ctrl+d': // scroll to the bottom of the page
            case 'command+d': 
                Scroll_to_the_Bottom( ); 
                break;
            case 'ctrl+h': 
            case 'command+h': 
                Toggle_Tooltips( ); 
                break;
            case 'ctrl+i': 
            case 'command+i': 
                Toggle_Introduction_Modal( ); 
                break;
            case 'ctrl+u': 
            case 'command+u': 
                Scroll_to_the_Top( ); 
                break;
            default: alert(event);
        }
    }); 
// scroll control
    function Scroll_to_the_Top( ) {
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }
    function Scroll_to_the_Bottom( ) {
      $( document ).scrollTop( $( document ).height( ) ); // scroll to the bottom
    }
// loading screen and modal control
    function Loading_Screen( bool_add_loading_screen ) { // add or remove loading screen
        if ( ( ! bool_add_loading_screen ) && document.getElementById( "svg_during_loading" ) != null ) {
            document.getElementById( "svg_during_loading" ).remove( ); // remove loading screen once plot is drawn
        } else if ( bool_add_loading_screen && document.getElementById( "svg_during_loading" ) == null ) {
            $("#loading_screen").append( [
                '<div class="loader loader--style1 _plotly-loading-callback" title="data is being loaded..." id="svg_during_loading">',
                    '<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve" rect="fill: #FF6700;" path>',
                        '<path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946',
                        's14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634',
                        'c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>',
                        '<path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0',
                        'C22.32,8.481,24.301,9.057,26.013,10.047z">',
                        '<animateTransform attributeType="xml"',
                          'attributeName="transform"',
                          'type="rotate"',
                          'from="0 20 20"',
                          'to="360 20 20"',
                          'dur="0.5s"',
                          'repeatCount="indefinite"/>',
                        '</path>',
                    '</svg>',
                '</div>' ].join( "" ) ); // display an SVG file during loading 
        }
    }
    function Toggle_Introduction_Modal( ) { 
        $( '#modal_introduction' ).modal( 'toggle' );
        document.getElementById( "modal_introduction" ).style[ "padding-right" ] = "0px";
    } // Toggle Modal for an Introduction 
// custom utility functions
    // getElementById
    function $id( id ) {
        return document.getElementById( id );
    }
    function isString ( value ) { // Returns if a value is a string
        return typeof value === 'string' || value instanceof String;
    }
    function String_Check_Substring( string, l_substring ) {
        let flag_contains_substring = false;
        string = string.toLowerCase( );
        for ( let i = 0; i < l_substring.length; i ++ ) {
            let substring = l_substring[ i ].toLowerCase( );
            if ( string.includes( substring ) ) {
                flag_contains_substring = true;
                break;
            }
        }
        return flag_contains_substring;
    }
    // functions for numpy-like operations
    function ArraySum( l ) { // return the sum of values of an array
        return l.reduce( (a, b) => a + b, 0 );
    }
    function ArrayIndexing( l, l_index ) {
        let l_output = [ ];
        for ( let i = 0; i < l_index.length; i++ ) { l_output.push( l[ l_index[ i ] ] ); }
        return l_output
    }
    function ArrayBooleanIndexing( l, l_bool ) {
        let l_output = [ ];
        for ( let i = 0; i < l_bool.length; i++ ) { if ( l_bool[ i ] ) { l_output.push( l[ i ] ); } }
        return l_output
    }
    function ArrayBoolAND( l_l ) {
        let l_output = [ ];
        for ( let j = 0; j < l_l[ 0 ].length; j++ ) {
            let output = true;
            for ( let i = 0; i < l_l.length; i++ ) { output = output && l_l[ i ][ j ]; }
            l_output.push( output );
        }
        return l_output;
    }
    function ArrayBoolOR( l_l ) {
        let l_output = [ ];
        for ( let j = 0; j < l_l[ 0 ].length; j++ ) {
            let output = false;
            for ( let i = 0; i < l_l.length; i++ ) { output = output || l_l[ i ][ j ]; }
            l_output.push( output );
        }
        return l_output;
    }
    function ArrayBoolNOT( l ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l[ i ] ? false : true ); }
        return l_output;
    }
    function ArrayGreaterThan( l, thres ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l[ i ] > thres ); }
        return l_output;
    }
    function ArrayLessThan( l, thres ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l[ i ] < thres ); }
        return l_output;
    }
    function ArrayFull( length, value ) {
        let l_output = [ ];
        for ( let i = 0; i < length; i++ ) { l_output.push( value ); }
        return l_output;
    }
    function ArrayBroadCasting( l, l_bool, value ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l_bool[ i ] ? value : l[ i ] ); }
        return l_output;
    }
    function ArrayCap( l, value ) { // cap value of a given list at the given capping value (manually set maximum value)
        l_modified = lodash.cloneDeep( l );
        for ( let i = 0; i < l.length; i ++ ) {
            if ( l[ i ] > value ) { // cap value of a given list at the given capping value (manually set maximum value)
                l_modified[ i ] = value;
            }
        }
        return l_modified
    }
    function ArrayFloor( l, value ) { // floor value of a given list at the given flooring value (manually set minimum value)
        l_modified = lodash.cloneDeep( l );
        for ( let i = 0; i < l.length; i ++ ) {
            if ( l[ i ] < value ) { // cap value of a given list at the given capping value (manually set maximum value)
                l_modified[ i ] = value;
            }
        }
        return l_modified
    }
    function ArrayApply( l, a_function ) { // apply certain function to all of values of a given array
        let l_output = [ ];
        for ( let i = 0; i < l.length; i ++ ) {
            l_output[ i ] = a_function( l[ i ] );
        }
        return l_output
    }
    function ArrayMap( l, dictionary, default_value = undefined ) { // map values in a given array using a given dictionary
        let l_output = [ ];
        for ( let i = 0; i < l.length; i ++ ) {
            l_output[ i ] = ( l[ i ] in dictionary ) ? dictionary[ l[ i ] ] : default_value;
        }
        return l_output
    }
    function ArrayTranspose( l_l ) { // transpose 2d array
        let n_row = l_l.length, n_col = l_l[ 0 ].length, l_l_t = [ ]; // transposed 2d array
        for ( let i = 0; i < n_col; i ++ ) {
            let l_t = [ ]; // transposed column (now a row)
            for ( let j = 0; j < n_row; j ++ ) { l_t.push( l_l[ j ][ i ] ); }
            l_l_t.push( l_t );
        }
        return l_l_t;
    }
    function ArrayAsInt( l ) { 
        let l_int = [ ];
        for ( let i = 0; i < l.length; i ++ ) {
            l_int.push( parseInt( l[ i ] ) ); // parse a string into an integer for each entry
        }
        return l_int
    } // convert array of strings to array of integers
    function ArrayAverage( l ) { // calculate average of values in the array
        let sum = l.reduce( ( a, b ) => a + b, 0 );
        let avg = ( sum / l.length ) || 0;
        return avg;
    }
    function ArrayMultiply( l, float_multiply_by ) { // return a list with values multiplied by 'float_multiply_by'
        let l_multiplied = [ ];
        for ( let i = 0; i < l.length; i ++ ) {
            l_multiplied.push( l[ i ] * float_multiply_by );
        }
        return l_multiplied;
    }
    function unpack( rows, key ) { 
        if ( Array.isArray( key ) ) { // if more than one key is given, return 2D-array of unpacked data
            let l_l_value = [ ];
            for ( let i = 0; i < rows.length; i ++ ) {
                let row = rows[ i ];
                let l_value = [ ];
                for ( let j = 0; j < key.length; j ++ ) { 
                    l_value.push( row[ key[ j ] ] );
                }
                l_l_value.push( l_value );
            }
            return l_l_value;
        } else { return rows.map( function( row ) { return row[ key ]; } ); } // if only a single key is given, return 1D-array of unpacked data
    };
    // tabular data
    function Unpack_String_rsa( seq ) { // unpack string containing RSA value using ASCII encoding (126 encodes null)
        let l_output = [ ];
        for ( let i = 0; i < seq.length; i ++ ) {
            let int_value = seq.charCodeAt( i ); // retrieve ASCII character as an integer number
            if ( int_value == 126 ) { l_output.push( null ); }
            else { l_output.push( Math.round( ( int_value - 33 ) / 92 * 100 ) / 100 ); } // RSA value range 0 ~ 1 // round up so that step is 1
        }
        return l_output;
    }
    function SplitColumn( dictarr, delimiter = '|' ) { // split column name of the given dict_array into two with the given delimiter character and return dict_dict_array # 20201106
        let dictdictarr = { };
        for ( let col in dictarr ) {
            let col_split = col.split( "|" );
            if ( ! ( col_split[ 0 ] in dictdictarr ) ) {
                dictdictarr[ col_split[ 0 ] ] = { };
            }
            dictdictarr[ col_split[ 0 ] ][ col_split[ 1 ] ] = dictarr[ col ];
        }
        return dictdictarr;
    }
    function SubsetDictDictArr( dictdictarr, l_col_inner, fill_empty_columm_if_not_exist = true, fill_value = 0 ) { // subset a given dictdictarr with a given list of l_col_inner list containing column names of the inner layer. if only one column is given, return dictarray containing the inner column # 20201106
        // 'fill_empty_columm_if_not_exist' : if true, fill empty column with 'fill_value' value
        if ( Array.isArray( l_col_inner ) ) { // subset a given dictdictarr with a given list of l_col_inner list containing column names of the inner layer.
            let dictdictarr_subset = { };
            for ( let col_outer in dictdictarr ) {
                for ( let i = 0; i < l_col_inner.length; i ++ ) {
                    let col_inner = l_col_inner[ i ];
                    if ( ! ( col_inner in dictdictarr[ col_outer ] ) ) {
                        if ( fill_empty_columm_if_not_exist ) { // 'fill_empty_columm_if_not_exist' : if true, fill empty column with 'fill_value' value
                            dictdictarr[ col_outer ][ col_inner ] = ArrayFull( dictdictarr[ col_outer ][ Object.keys( dictdictarr[ col_outer ] )[ 0 ] ].length, fill_value ); // assume that the length of array is same for all columns
                        }
                    } else {
                        if ( ! ( col_outer in dictdictarr_subset ) ) {
                            dictdictarr_subset[ col_outer ] = { };
                        }
                        dictdictarr_subset[ col_outer ][ col_inner ] = dictdictarr[ col_outer ][ col_inner ]
                    }
                }
            }
            return dictdictarr_subset;
        } else { // if only one column is given, return dictarray containing the inner column
            let col_inner_subset = l_col_inner;
            let dictarr = { };
            for ( let col_outer in dictdictarr ) {
                if ( ! ( col_inner_subset in dictdictarr[ col_outer ] ) ) {
                    dictarr[ col_outer ] = ArrayFull( dictdictarr[ col_outer ][ Object.keys( dictdictarr[ col_outer ] )[ 0 ] ].length, fill_value ); // assume that the length of array is same for all columns
                } else {
                    dictarr[ col_outer ] = dictdictarr[ col_outer ][ col_inner_subset ]
                }
            }
            return dictarr;
        }
    }
    function DictArrBooleanIndexing( dictarr, l_bool ) { // subset dictarr using a given boolean index (assumes the length of arrays for all keys are the same).
        let dictarr_new = { },
            l_key = Object.keys( dictarr );
        // for each array of a key in dictarr, perform boolean indexing using the given boolean index
        for ( let i = 0; i < l_key.length; i ++ ) { 
            let str_key = l_key[ i ];
            dictarr_new[ str_key ] = ArrayBooleanIndexing( dictarr[ str_key ], l_bool );
        }
        return dictarr_new;
    }
    function Pivot( l_index, l ) { // return dictarr where unique entries of l_index are keys and a list of correspondinb values to each entry (key) is a value to each key. // similar to 'Index_list_with_dictionary' function
        let dictarr = { };
        for ( let i = 0; i < l_index.length; i ++ ) {
            let index = l_index[ i ];
            if ( index in dictarr ) {
                dictarr[ index ].push( l[ i ] );
            } else {
                dictarr[ index ] = [ l[ i ] ];
            }
        }
        return dictarr;
    }
    // indexing
    function Index_list_with_dictionary( l ) { // build dictionary containing list for indices for a given list of accessions (key = accession, value = list of indices containing the accession)
        let dictionary_index = { };
        for ( let i = 0; i < l.length; i ++ ) { 
            let acc = l[ i ];
            if ( acc in dictionary_index ) {
                dictionary_index[ acc ].push( i )
            } else {
                dictionary_index[ acc ] = [ i ]; // initialize value of key encountered for the first time
            }
        }
        return dictionary_index;
    }
    // counter
    function Counter( l ) { // count entries in the list
        let dict_count = { };
        for ( entry of l ) {
            if ( entry in dict_count ) {
                dict_count[ entry ] += 1;
            } else {
                dict_count[ entry ] = 1;
            }
        }
        return dict_count;
    }
    function FindTheMajority( l ) { // count entries in the list and return the majority in the list
        let dict_count = Counter( l ), key_majority = '', count_majority = 0;
        for ( key of Object.keys( dict_count ) ) { // for each key
            let count = dict_count[ key ];
            if ( count > count_majority ) { // if the count of the current key is larger than count of majority key, update the majority key name
                key_majority = key;
                count_majority = count;
            }
        }
        return key_majority;
    }
    // colormap
    function Color_for_rsa( l_rsa ) {
        let l_color = [ ], function_colormap = function_colormap_rsa;
        for ( let i = 0; i < l_rsa.length; i ++ ) { l_color.push( l_rsa[ i ] == null? color_representing_null : function_colormap( l_rsa[ i ] * 2 ).toString( ) ); } // RSA of 0.5 will be represented as 'fully accessible to the surface'
        return l_color;
    }
    // select
    function Select_RemoveOptions( selectElement ) { // remove all option in the select element
       let length = selectElement.options.length - 1;
       for( let i = length; i >= 0; i -- ) {
          selectElement.remove( i );
       }
    }
    function Select_Get_Selected_Option_Using_ID( id_selectElement ) { // get selected option in the select element with its id
        let sel = document.getElementById( id_selectElement )
        return sel.options[ sel.selectedIndex ]
    }
    // specific to single cell expression data
    function RemoveNegativeCells( l_expr ) { // count and remove cells with zero counts as a expression value 
        let l_expr_without_negative_cells = [ ], n_cells_nagative = 0;
        for ( let i = 0; i < l_expr.length; i ++ ) {
            let expr = l_expr[ i ];
            if ( expr == 0 ) {
                n_cells_nagative += 1;
            } else {
                l_expr_without_negative_cells.push( expr );
            }
        }
        return { l_expr_without_negative_cells: l_expr_without_negative_cells, n_cells_nagative: n_cells_nagative };
    }
    // Load data
    function LoadRemoteTextFile( remoteFilePath ) { // load remote text file using xml_http_request (syncrhonous)
        let result = null;
        let xmlhttp = new XMLHttpRequest();
        xmlhttp.open( "GET", remoteFilePath, false );
        xmlhttp.send( );
        if ( xmlhttp.status == 200 ) {
            result = xmlhttp.responseText;
        }
        return result;
    }
    async function LoadLocalTextFile( file ) { // load and return a local text file using FileReader (asyncrhonous)
        return new Promise( ( resolve, reject ) => {
            let reader = new FileReader( ); // initialize FileReader
            reader.onload = function( progressEvent ) {
                console.log( "[LoadLocalTextFile] local text file", file, "loaded and parsed." );
                resolve( this.result ); // when loading and parsing is complete, resolve the promise
            };
            reader.readAsText( file )
        });
    }
    function LoadRemoteTextFile_PartialData( remoteFilePath, l_range = [ ] ) { // load remote text file using xml_http_request (syncrhonous) // l_range = list of ranges of bytes positions for partial downloads
        let result = null;
        let xmlhttp = new XMLHttpRequest( ),
            l_str_range = [ ];
        xmlhttp.open( "GET", remoteFilePath, false );
        if ( l_range.length == 0 ) { // handle empty l_range
            return '';
        } 
        xmlhttp.setRequestHeader('Range', 'bytes=' + l_range.map( l  => l.map( int_byte => int_byte.toString( ) ).join( '-' ) ).join( ', ' ) ); // compose a range header
        xmlhttp.send( );
        if ( xmlhttp.status == 206 ) {
            result = xmlhttp.responseText;
        }
        return result;
    }
    async function RetrieveRemoteFile_PartialData( l_index, dict_arr, dir_remote_file ) {
        // when 'flag_split_file' is true, assumes the main concatenated files are split into multiple file to satisfy maximum file size limits
        flag_split_file = 'index_file' in dict_arr; // check whether dict_arr contains the 'index_file' column
        if ( flag_split_file ) {
            let dict_index_file_to_l_range = { }, i = 0;
            // retrieve range containing records for each split file
            for ( i = 0; i < l_index.length ; i ++ ) {
                let index_record = l_index[ i ],
                    index_byte_start = dict_arr.index_byte_start[ index_record ],
                    index_byte_end = dict_arr.index_byte_end[ index_record ],
                    index_file = dict_arr.index_file[ index_record ];
                if ( ! ( index_file in dict_index_file_to_l_range ) ) {
                    dict_index_file_to_l_range[ index_file ] = [ ];
                }
                dict_index_file_to_l_range[ index_file ].push( [ index_byte_start + 1, index_byte_end - 1 ] ); // the first byte in each 'file' in the concatanated files is a spacer character (' ')
            }
            // retrieve data and parse data into records for each split file
            let l_record = [ ],
                l_index_file = Object.keys( dict_index_file_to_l_range );
            for ( i = 0; i < l_index_file.length; i ++ ) {
                // retrieve text records from a remote file
                let index_file = l_index_file[ i ],
                    l_range = dict_index_file_to_l_range[ index_file ];
                let text_combined = LoadRemoteTextFile_PartialData( dir_remote_file + '.' + index_file.toString( ), l_range ),
                    l_text = [ ];
                if ( l_range.length == 1 ) {
                    // when partial data of single part is retrieved, add all of the retrieved string to the list
                    l_text.push( text_combined );
                } else {
                    let l_split = text_combined.split( '\r\n' ).slice( 1, -1 ), index_text = 4; // retrieved data starts from the fifth line (index = 4)
                    for ( i = 0; i < l_range.length; i ++ ) {
                        l_text.push( l_split[ index_text ] ); 
                        index_text += 5; // retrieved data is in every fifth line
                    }
                }
                l_record.push( ... await ParseLocalData( l_text ) );
            }
            return l_record;
        } else {
            let l_range = [ ], i = 0;
            // retrieve text records from a remote file
            for ( i = 0; i < l_index.length ; i ++ ) {
                let index_record = l_index[ i ],
                    index_byte_start = dict_arr.index_byte_start[ index_record ],
                    index_byte_end = dict_arr.index_byte_end[ index_record ];
                l_range.push( [ index_byte_start + 1, index_byte_end - 1 ] ); // the first byte in each 'file' in the concatanated files is a spacer character (' ')
            }
            let text_combined = LoadRemoteTextFile_PartialData( dir_remote_file, l_range ),
                l_text = [ ];
            if ( l_range.length == 1 ) {
                // when partial data of single part is retrieved, add all of the retrieved string to the list
                l_text.push( text_combined );
            } else {
                let l_split = text_combined.split( '\r\n' ).slice( 1, -1 ), index_text = 4; // retrieved data starts from the fifth line (index = 4)
                for ( i = 0; i < l_range.length; i ++ ) {
                    l_text.push( l_split[ index_text ] ); 
                    index_text += 5; // retrieved data is in every fifth line
                }
            }
            return await ParseLocalData( l_text );
        }
    }
    async function ParseLocalData( l_text, flag_base64 = true ) { // parse local string or base64 string
        return new Promise( async function( resolve, reject ) { 
            let l_promise = l_text.map( function( text ) { 
                return new Promise ( function( resolve, reject ) {
                    // parse base64 strings
                    if ( flag_base64 ) {
                        text = ParseBase64GzippedText( text );
                    } 
                    Papa.parse( text, { download: false, header: false, skipEmptyLines: false, delimiter: '\t', worker: true, dynamicTyping: true, complete: function( results ) { resolve( ParseTransposedArrayWithHeader( results.data.slice( 0, results.data.length - 1 ) ) ) }, error: reject } ); // remove last empty line
                });
            }); // 'skipEmptyLines' is set to false to allow reading empty lines in some input files // due to 'skipEmptyLines: false' option, the last line is empty, and should be discarded
            let results = await Promise.all( l_promise ); // wait until all files have been parsed by Papa.parse
            let l_parsed_data = [ ]; 
            l_parsed_data.push( ... results );
            resolve( l_parsed_data );
        });
    }
    function ParseBase64GzippedText( str_base64_gzipped ) {
        // Decode base64 (convert ascii to binary) // Convert binary string to character-number array // Turn number array into byte-array // Convert gunzipped byteArray back to ascii string:
        let l_char = pako.inflate( new Uint8Array( atob( str_base64_gzipped ).split( '' ).map( function( x ) { return x.charCodeAt( 0 ); } ) ) ); 
        let str_content = ""; // convert ASCII value to character and concatenate the characters into a string
        for ( let i = 0; i < l_char.length; i ++ ) {
            str_content += String.fromCharCode( l_char[ i ] );
        }
        return str_content;
    }
    function ParseTransposedArrayWithHeader( l_l ) { // return a dictionary of arrays ( similar to the DataFrame.toDict() output ) from an array of arrays
        let dictarr = { };
        for ( let i = 0; i < l_l.length; i ++ ) {
            let key = l_l[ i ].shift( );
            dictarr[ key ] = l_l[ i ];
        }
        return dictarr;
    }
    async function LoadRemoteData( l_file ) { // load list of given tsv files from remote locations through asynchrous operations
        return new Promise( async function( resolve, reject ) { 
            // retrieve the name of files that are needed to be downloaded (skip the files that are already downloaded)
            let l_name_file = [ ], l_file_to_be_downloaded = [ ];
            for ( let i = 0; i < l_file.length; i ++ ) { 
                let url_file = l_file[ i ], name_file = url_file.slice( url_file.lastIndexOf( "/" ) + 1 )
                if ( ! ( name_file in object_data.file.dict_name_file_to_parsed_data ) ) {
                    l_file_to_be_downloaded.push( url_file );
                    l_name_file.push( name_file );
                }
            } // put parsed data into a dictionary
            l_file = l_file_to_be_downloaded; 
            console.log( "[LoadRemoteData] remote data fetch started:", l_file );
            Loading_Screen( true ) // add loading screen
            let l_promise = l_file.map( function( file ) { 
                if( file.split( '.' ).slice( - 1 )[ 0 ] == "tsv" ) { // if given remote file is a tsv file
                    return new Promise ( function( resolve, reject ) {
                        Papa.parse( file, { download: true, header: false, skipEmptyLines: false, delimiter: '\t', worker: true, dynamicTyping: true, complete: function( results ) { resolve( ParseTransposedArrayWithHeader( results.data.slice( 0, results.data.length - 1 ) ) ) }, error: reject } ); // remove last empty line
                    });
                } else if ( file.split( '.' ).slice( - 2 ).join( '.' ) == "base64.txt" ) { // if given remote file is base64-encoded binary file
                    return new Promise ( function( resolve, reject ) {
                        fetch( file )
                            .then( ( response ) => {
                              return response.text( );
                           }).then( ( text_base64 ) => {
                              return ParseBase64GzippedText( text_base64 );
                           }).then( ( text ) => {
                              Papa.parse( text, { download: false, header: false, skipEmptyLines: false, delimiter: '\t', worker: true, dynamicTyping: true, complete: function( results ) { resolve( ParseTransposedArrayWithHeader( results.data.slice( 0, results.data.length - 1 ) ) ) }, error: reject } ); // remove last empty line
                           }).catch( err => { reject } );
                    });
                }
            }); // 'skipEmptyLines' is set to false to allow reading empty lines in some input files // due to 'skipEmptyLines: false' option, the last line is empty, and should be discarded
            let results = await Promise.all( l_promise ); // wait until all files have been parsed by Papa.parse
            let l_parsed_data = [ ]; 
            l_parsed_data.push( ... results );
            for ( let i = 0; i < l_file.length; i ++ ) { 
                let url_file = l_file[ i ], name_file = url_file.slice( url_file.lastIndexOf( "/" ) + 1 )
                object_data.file.dict_name_file_to_parsed_data[ name_file ] = l_parsed_data[ i ];
            } // put parsed data into a dictionary
            console.log( "[LoadRemoteData] remote data loaded:", l_file );
            resolve( "[LoadRemoteData] resolved" )
            Loading_Screen( false ) // add loading screen
        });
    }
    async function ParseData( ) { // parse loaded data and prepare data objects
        return new Promise( async function( resolve, reject ) { 
            let name_adata = object_data.main.name_adata; // retrieve the name of the current dataset
            Loading_Screen( true );
        // initialize cache objects
            InitializeCacheForRemoteData( object_data.main.gene.expr, object_data.file.dict_name_file_to_parsed_data[ "expr." + name_adata + ".multiplied_by_1000.index.tsv.gz.base64.txt" ], [ 'gene_symbol' ], object_data.file.base_url + "expr." + name_adata + ".multiplied_by_1000.tsv.gz.base64.concatenated.txt" )
            EvictCache( object_data.main.gene.expr, null, true ); // purge gene expression data of the previous dataset to save up space
            InitializeCacheForRemoteData( object_data.main.cell_marker, object_data.file.dict_name_file_to_parsed_data[ "cell_marker.index.tsv.gz.base64.txt" ], [ 'cluster_name' ], object_data.file.base_url + "cell_marker.tsv.gz.base64.concatanated.txt" )
//             InitializeCacheForRemoteData( object_data.main.gene.correl, object_data.file.dict_name_file_to_parsed_data[ "expr.correlation.index.tsv.gz.base64.txt" ], [ 'gene_symbol' ], object_data.file.base_url + "expr.correlation.tsv.gz.base64.concatanated.txt" )

            console.log( "[ParseData] resolved" );
            Loading_Screen( false );
            resolve( "[ParseData] resolved" );
        });
    }
    // caching data from local or remote sources
    function InitializeCacheForRemoteData( object_cache, dict_arr_index, l_col_key, dir_remote_file ) { 
        object_cache.dir_remote_file = dir_remote_file;
        object_cache.dict_arr_index = dict_arr_index;
        // index 'dict_arr_index' with 'l_col_key', combining values from 'l_col_key' with '|'
        object_cache.l_col_key = l_col_key;
        let l_key = [ ], i = 0, j = 0;
        if ( l_col_key.length > 1 ) {
            let n_records = object_cache.dict_arr_index[ l_col_key[ 0 ] ].length;
            for ( i = 0; i < n_records; i ++ ) {
                let l_value = [ ];
                for ( j = 0; j < l_col_key.length; j ++ ) { 
                    l_value.push( dict_arr_index[ l_col_key[ j ] ][ i ] );
                }
                l_key.push( l_value.join( '|' ) );
            }
        } else {
            l_key = object_cache.dict_arr_index[ l_col_key[ 0 ] ];
        }
        object_cache.l_key = l_key;
        object_cache.dict_key_to_index = Index_list_with_dictionary( l_key );
    }
    function EvictCache( object_cache, l_key = null, flag_purge = false ) { // evict cache according to the amount of incoming data (l_key). Evict all data if flag_perge is true
        if ( flag_purge ) {
            // completely empty the cache data
            delete object_cache.data;
            object_cache.data = { }; 
            return true;
        }
//         console.log( "[EvictCache] evicting cache for the following incoming data", l_key );
        // retrieve list of keys that should be updated (keys that cannot be found in the cached data)
        let i = 0, j = 0,
            cache = object_cache.data,
            int_size_cache = object_cache.data_size,
            l_key_to_be_updated = [ ];
        for ( i = 0; i < l_key.length; i ++ ) {
            let str_key = l_key[ i ];
            if ( ! ( str_key in cache ) ) { // check cached data
                l_key_to_be_updated.push( str_key );
            }
        }
        // download data from a large indexed file, and add the new data to the cache
        if ( l_key_to_be_updated.length > int_size_cache ) {
            l_key_to_be_updated = l_key_to_be_updated.slice( 0, int_size_cache ); // slice the list of requested genes so that the number of retrieved gene does not exceed that of cache size.
//             console.log( "[EvictCache] number of incoming records exceeds the maximum size of cache, only retrieving records in the front. The following keys will be fetched", l_key_to_be_updated );
        }
        let int_n_records_newly_added = l_key_to_be_updated.length,
            int_n_records_to_be_evicted = Math.max( 0, Object.keys( cache ).length + int_n_records_newly_added - int_size_cache );
        // iteratively evict 'int_n_records_to_be_evicted' number of records based on the last used time
        for ( i = 0; i < int_n_records_to_be_evicted; i ++ ) {
            let l_key_in_a_cache = Object.keys( cache ), // one key is used to store the size of cache
                str_key_least_recently_used = -1,
                time_least_recently_used = -1;
            for ( j = 0; j < l_key_in_a_cache.length; j ++ ) {
                let str_key = l_key_in_a_cache[ j ],
                    time_last_used = cache[ str_key ].last_used_time;
                if ( ( time_least_recently_used == -1 ) | ( time_last_used < time_least_recently_used ) ) {
                    str_key_least_recently_used = str_key;
                    time_least_recently_used = time_last_used;
                }
            }
//             console.log( "[EvictCache] evicting", str_key_least_recently_used );
            delete cache[ str_key_least_recently_used ];
        }
        return l_key_to_be_updated;
    }
    async function UpdateCache( object_cache, function_preprocessing_data = null, l_key_to_be_updated_from_remote_source = null, dict_incoming_data = null ) { // update cache using either locally available data 'dict_incoming_data' (key = key for caching, value = incoming data) or remotely available data 'l_key_to_be_updated_from_remote_source'
        return new Promise( async function( resolve, reject ) { 
            let i = 0, flag_cache_evicted = false; // a flag indicating whether cache has been evicted 
            if ( dict_incoming_data === null ) {
                if ( l_key_to_be_updated_from_remote_source === null ) {
                    console.log( '[UpdateCache] required arguments not given' );
                    return false;
                }
                l_key_to_be_updated_from_remote_source = EvictCache( object_cache, l_key_to_be_updated_from_remote_source ); // evict (free) cache data before downloading new data from the remote source
                flag_cache_evicted = true;
                let l_index_key = [ ];
                for ( i = 0; i < l_key_to_be_updated_from_remote_source.length; i ++ ) {
                    l_index_key.push( object_cache.dict_key_to_index[ l_key_to_be_updated_from_remote_source[ i ] ][ 0 ] );
                }
                let l_record = await RetrieveRemoteFile_PartialData( l_index_key, object_cache.dict_arr_index, object_cache.dir_remote_file );
                dict_incoming_data = { };
                for ( i = 0; i < l_record.length; i ++ ) {
                    dict_incoming_data[ l_key_to_be_updated_from_remote_source[ i ] ] = l_record[ i ];
                }
            }
            let l_key = Object.keys( dict_incoming_data );
            if ( ! flag_cache_evicted ) {
                l_key = EvictCache( object_cache, l_key ); // evict (free) cache data before adding new data to the cache
            }
            for ( i = 0; i < l_key.length; i ++ ) {
                let str_key = l_key[ i ],
                    record = dict_incoming_data[ str_key ];
                object_cache.data[ str_key ] = { data : ( function_preprocessing_data === null ) ? record : function_preprocessing_data( record ), last_used_time : new Date( ).getTime( ) }; // add new data to the cache
            }
    //         console.log( '[UpdateCache] cache data updated with the following data:', dict_incoming_data );
            resolve( "[UpdateCache] Resolved" ); 
        });
    }
    
    var div_current_view = $( "#application-current-view" ); // global variable
    function DownloadCurrentView( ) {
         html2canvas( div_current_view.get( 0 ) ).then ( function ( canvas ) {
                var imgageData = canvas.toDataURL("image/png");
                // Now browser starts downloading it instead of just showing it
                var newData = imgageData.replace(/^data:image\/png/, "data:application/octet-stream");
                $("#anchor-current-view").attr("download", "Single Cell CAF Atlas-screenshot.png").attr( "href", newData );
                $("#anchor-current-view").get( 0 ).click( ) // download image file
         });
    }
    
    var searchbox_main = document.getElementById( 'searchbox_main' ), tagify_searchbox_main = { };
    object_data.flags.flag_tagify_searchbox_main_mutationobserver_attached = false;
    function Initialize_SearchBox_Main( ) {
        let name_adata = object_data.main.name_adata; // retrieve the name of the current dataset
        tagify_searchbox_main = new Tagify( searchbox_main, {
            dropdown: { 
                maxItems: parseInt( ( window.innerHeight > 1500 ) ? 100 : Math.max( 1, ( window.innerHeight - 500 ) / 100 ) ), // set max number of dropdown items according to the window height
                enabled: 0,
                position: 'text', // enable minimal sizing of a dropdown list
                highlightFirst: true, // enable enhanced autocomplete feature
            },
            maxTags: object_data.main.gene.expr.data_size, // max number of tags = max size of gene expression data cache
            editTags: false, // disable editing
            enforceWhitelist: true, whitelist: object_data.file.dict_name_file_to_parsed_data[ "expr." + name_adata + ".multiplied_by_1000.index.tsv.gz.base64.txt" ][ "gene_symbol" ]
        })
        // Chainable event listeners
        tagify_searchbox_main
              .on( 'add', e => { 
            console.log( "onAddTag: ", e.detail.data.value );
            if ( object_data.main.scatter.flag_waiting_selection_of_gene ) { // use the selected gene as one of the axes of the scatter plot
                object_data.main.scatter.gene_symbol_selected = e.detail.data.value;
                Change_UMAP_Coordinate( null );
            } else { // use the selected gene to color points
                object_data.main.gene.gene_symbol = e.detail.data.value;
                UpdateGene( flag_restyle = true );
            }
            $( e.detail.tag ).mouseenter( function( e ) {
                console.log( 'mouse enter', e )
                let gene_symbol = e.target.textContent; // retrieve gene_symbol
                // preview a gene on hover
                $( "#container_plotly_searchbox_main_preview" ).collapse( 'show' ); // show boxplot panel
                PreviewGene( gene_symbol );
            })
                .mouseleave( function( e ) {
                console.log( 'mouse leave', e )
                // hide boxplot panel
                $( "#container_plotly_searchbox_main_preview" ).collapse( 'hide' ); // show boxplot panel
            })
                .mousemove( function( e ) {
                console.log( 'mouse move', e )
                // show boxplot panel
                $( "#container_plotly_searchbox_main_preview" ).collapse( 'show' ); // show boxplot panel
            })
        } )
              .on( 'click', e => { 
            console.log( "onClickTag: ", e.detail.data.value );
            if ( object_data.main.scatter.flag_waiting_selection_of_gene ) { // use the selected gene as one of the axes of the scatter plot
                object_data.main.scatter.gene_symbol_selected = e.detail.data.value;
                Change_UMAP_Coordinate( null );
            } else { // use the selected gene to color points
                object_data.main.gene.gene_symbol = e.detail.data.value;
                UpdateGene( flag_restyle = true );
            }
        } )
              .on( 'remove', e => { console.log( "onRemoveTag: ", e.detail ); } )
              .on('input', e => { // preview during typing
            if ( ! isString( e.detail.value ) ) { return -1; }
            let gene_symbol = e.detail.value; // retrieve current input
            if ( gene_symbol in object_data.main.gene.expr.dict_key_to_index ) { // show preview of the gene if it exists in the data
                PreviewGene( gene_symbol );
            }
        } )
              .on( "dropdown:hide", ( e ) => { console.log( "dropdown:hide" ); $( "#container_plotly_searchbox_main_preview" ).collapse( 'hide' ); } )
              .on( "dropdown:show", ( e ) => { // preview during exploring dropdown options
            $( "#container_plotly_searchbox_main_preview" ).collapse( 'show' );
            console.log( "dropdown:show" );
            if ( ! object_data.flags.flag_tagify_searchbox_main_mutationobserver_attached ) {
                let dropdown = document.querySelector( '.tagify__dropdown' ); // retrieve DOM of active dropdown
                let options = {
                    subtree: true,
                    attributes: true
                };
                let observer = new MutationObserver( function( mutations ) {
                    mutations.forEach( function( e ) {
                        if ( ( e.attributeName == 'class' ) & ( e.target.className == "tagify__dropdown__item tagify__dropdown__item--active" ) ) { // detect the innerHTML of the active element using MutationObserver (the closely matched gene_symbol)
                            console.log( "dropdown active element:", e.target.innerHTML );
                            PreviewGene( e.target.innerHTML );
                        }
                    });
                });
                observer.observe( dropdown, options );
                let dragsort = new DragSort( tagify_searchbox_main.DOM.scope, {
                    selector: '.' + tagify_searchbox_main.settings.classNames.tag,
                    callbacks: {
                        dragEnd: ( elm ) => { tagify_searchbox_main.updateValueByDOMTags( ); }
                    }
                });
                object_data.flags.flag_tagify_searchbox_main_mutationobserver_attached = true; // set the flag to true after attaching mutationobserver to the dropdown list so that another observer is not attached.
            }
        })
    }
    var searchbox_cell_cluster = document.getElementById( 'searchbox_cell_cluster' ), tagify_searchbox_cell_cluster = { };
    function Initialize_SearchBox_CellCluster( ) {
        whitelist = object_data.file.dict_name_file_to_parsed_data[ "expr.multiplied_by_1000.index.tsv.gz.base64.txt" ][ "gene_symbol" ]
        tagify_searchbox_cell_cluster = new Tagify( searchbox_cell_cluster, {
            dropdown: { 
                maxItems: 100,
                enabled: 0,
                position: 'text', // enable minimal sizing of a dropdown list
                highlightFirst: true, // enable enhanced autocomplete feature
            },
            maxTags: object_data.main.gene.expr.data_size, // max number of tags = max size of gene expression data cache
            editTags: false, // disable editing
            enforceWhitelist: true, whitelist: object_data.file.dict_name_file_to_parsed_data[ "expr.multiplied_by_1000.index.tsv.gz.base64.txt" ][ "gene_symbol" ]
        })
//         // Chainable event listeners
//         tagify_searchbox_cell_cluster
//               .on( 'add', e => { 
//             console.log( "onAddTag: ", e.detail.data.value );
//             let index_gene = object_data.main.gene.dict_gene_symbol_lowercase_to_index_gene[ e.detail.data.value.toLowerCase( ) ];
//             object_data.main.gene.index_gene = index_gene;
//             UpdateGene( );
//         } )
        
//               .on( 'click', e => { 
//             console.log( "onClickTag: ", e.detail.data.value );
//             let index_gene = object_data.main.gene.dict_gene_symbol_lowercase_to_index_gene[ e.detail.data.value.toLowerCase( ) ];
//             object_data.main.gene.index_gene = index_gene;
//             UpdateGene( );
//         } )
//               .on( 'remove', e => { console.log( "onRemoveTag: ", e.detail ); } )
//               .on('input', e => { // preview during typing
//             if ( ! isString( e.detail.value ) ) { return -1; }
//             let gene_symbol_lowercase = e.detail.value.toLowerCase( ); // retrieve current input
//             if ( gene_symbol_lowercase in object_data.main.gene.dict_gene_symbol_lowercase_to_index_gene ) { // show preview of the gene if it exists in the data
//                 let index_gene = object_data.main.gene.dict_gene_symbol_lowercase_to_index_gene[ gene_symbol_lowercase ];
//                 PreviewGene( index_gene );
//             }
//         } )
//               .on( "dropdown:hide", ( e ) => { console.log( "dropdown:hide" ); $( "#container_plotly_searchbox_main_preview" ).collapse( 'hide' ); } )
//               .on( "dropdown:show", ( e ) => { // preview during exploring dropdown options
//             $( "#container_plotly_searchbox_main_preview" ).collapse( 'show' );
//             console.log( "dropdown:show" );
//             if ( ! object_data.flags.flag_tagify_searchbox_main_mutationobserver_attached ) {
//                 let dropdown = document.querySelector( '.tagify__dropdown' ); // retrieve DOM of active dropdown
//                 let options = {
//                     subtree: true,
//                     attributes: true
//                 };
//                 let observer = new MutationObserver( function( mutations ) {
//                     mutations.forEach( function( e ) {
//                         if ( ( e.attributeName == 'class' ) & ( e.target.className == "tagify__dropdown__item tagify__dropdown__item--active" ) ) { // detect the innerHTML of the active element using MutationObserver
//                             console.log( "dropdown active element:", e.target.innerHTML );
//                             let index_gene = object_data.main.gene.dict_gene_symbol_lowercase_to_index_gene[ e.target.innerHTML.toLowerCase( ) ];
//                             PreviewGene( index_gene );
//                         }
//                     });
//                 });
//                 observer.observe( dropdown, options );
//                 let dragsort = new DragSort( tagify_searchbox_cell_cluster.DOM.scope, {
//                     selector: '.' + tagify_searchbox_cell_cluster.settings.classNames.tag,
//                     callbacks: {
//                         dragEnd: ( elm ) => { tagify_searchbox_cell_cluster.updateValueByDOMTags( ); }
//                     }
//                 });
//                 object_data.flags.flag_tagify_searchbox_main_mutationobserver_attached = true; // set the flag to true after attaching mutationobserver to the dropdown list so that another observer is not attached.
//             }
//         })
    }
    
    object_data.main.gene.expr = { data : { }, data_size : 250 }; // cache of expression data // size of the cache
    object_data.main.cell_marker = { data : { }, data_size : 5 };
    object_data.main.gene.correl = { data : { }, data_size : 10 };
    object_data.main.umap = { tissue : 'not_drawn' }
    object_data.main.scatter = { x_label : 'UMAP-1', y_label : 'UMAP-2', x_axis_option : '__UMAP__', y_axis_option : '__UMAP__', x_axis_col_name : 'UMAP_1', y_axis_col_name : 'UMAP_2', flag_waiting_selection_of_gene : false, gene_symbol_selected : '', flag_axis_using_gene_expr : true }; // initialize axis of the scatter plot
    object_data.setting.expression = { };
    object_data.setting.expression.n_digits_below_floating_point = 3; // number of digits below floading point of the original expression values (converted to integer by multiplying 1000 during delivery of the data)
    object_data.main.datatable = { 'datatable_cell_marker' : { df : null, name : 'cell_marker' }, 'datatable_correl' : { df : null, name : 'correl_gene' } };
    
    async function Change_UMAP_Coordinate( str_tissue = null ) { 
        return new Promise( async function( resolve, reject ) { 
            if ( str_tissue === null ) {
                // change x or y-axis of scatter plot using the current setting
                let select_x_axis = $id( 'select_scatter_x_axis' ),
                    select_y_axis = $id( 'select_scatter_y_axis' ),
                    x_axis_option_current = select_x_axis.value,
                    y_axis_option_current = select_y_axis.value,
                    x_axis_option_previous = object_data.main.scatter.x_axis_option,
                    y_axis_option_previous = object_data.main.scatter.y_axis_option,
                    flag_update_x_axis = x_axis_option_current != x_axis_option_previous,
                    flag_update_y_axis = y_axis_option_current != y_axis_option_previous,
                    flag_update_axis = flag_update_x_axis | flag_update_y_axis;
                if ( ! flag_update_axis ) {
                    console.log( "[Change_UMAP_Coordinate] no change in x- or y-axis setting detected, exiting" );
                    return -1
                }
                if ( flag_update_x_axis ) { // update x-axis
                    let option_gene = select_x_axis.options[ 1 ];
                    if( x_axis_option_current == '__UMAP__' ) {
                        object_data.main.scatter.x_label = 'UMAP-1';
                        object_data.main.scatter.x_axis_option = x_axis_option_current;
                        object_data.main.scatter.x_axis_col_name = '__UMAP__';
                        // reset select option
                        option_gene.value = 'Gene';
                        option_gene.innerHTML = 'Gene';
                        object_data.main.scatter.flag_axis_using_gene_expr = false;
                    } else if ( object_data.main.scatter.flag_waiting_selection_of_gene ) {
                        // update setting for scatter plot
                        let gene_symbol = object_data.main.scatter.gene_symbol_selected;
                        object_data.main.scatter.flag_waiting_selection_of_gene = false; // reset flag
                        object_data.main.scatter.x_label = gene_symbol;
                        object_data.main.scatter.x_axis_option = gene_symbol;
                        object_data.main.scatter.x_axis_col_name = '__x_axis_gene_expr__';
                        object_data.main.scatter.flag_axis_using_gene_expr = true;
                        // update select option
                        option_gene.value = gene_symbol;
                        option_gene.innerHTML = gene_symbol;
                    } else {
                        object_data.main.scatter.flag_waiting_selection_of_gene = true;
                        // lock selection button to allow the selection of axis by clicking gene_symbol
                        select_x_axis.disabled = true;
                        select_y_axis.disabled = true;
                        console.log( '[Change_UMAP_Coordinate] (X-axis) waiting a gene_symbol to be selected' );
                        return 1;
                    }
                } else {
                    let option_gene = select_y_axis.options[ 1 ];
                    if( y_axis_option_current == '__UMAP__' ) {
                        object_data.main.scatter.y_label = 'UMAP-2';
                        object_data.main.scatter.y_axis_option = y_axis_option_current;
                        object_data.main.scatter.y_axis_col_name = '__UMAP__';
                        // reset select option
                        option_gene.value = 'Gene';
                        option_gene.innerHTML = 'Gene';
                        object_data.main.scatter.flag_axis_using_gene_expr = false;
                    } else if ( object_data.main.scatter.flag_waiting_selection_of_gene ) {
                        // update setting for scatter plot
                        let gene_symbol = object_data.main.scatter.gene_symbol_selected;
                        object_data.main.scatter.flag_waiting_selection_of_gene = false; // reset flag
                        object_data.main.scatter.y_label = gene_symbol;
                        object_data.main.scatter.y_axis_option = gene_symbol;
                        object_data.main.scatter.y_axis_col_name = '__y_axis_gene_expr__';
                        object_data.main.scatter.flag_axis_using_gene_expr = true;
                        // update select option
                        option_gene.value = gene_symbol;
                        option_gene.innerHTML = gene_symbol;
                    } else {
                        object_data.main.scatter.flag_waiting_selection_of_gene = true;
                        // lock selection button to allow the selection of axis by clicking gene_symbol
                        select_x_axis.disabled = true;
                        select_y_axis.disabled = true;
                        console.log( '[Change_UMAP_Coordinate] (Y-axis) waiting a gene_symbol to be selected' );
                        return 1;
                    }
                }
            } else { 
                let name_adata = object_data.main.name_adata; // retrieve the name of the current dataset
                // change UMAP coordinates to the UMAP coordinates of the given subclustering
                // only update coordinates when subclustering or name of dataset is different
                if ( ( str_tissue == object_data.main.umap.tissue ) && ( name_adata == object_data.main.umap.name_adata ) ) {
                    console.log( "[Change_UMAP_Coordinate] UMAP coordinates of", str_tissue, 'for', name_adata, "already drawn, exiting" );
                    return -1;
                }
                object_data.main.umap.tissue = str_tissue; // update str_tissue of the main UMAP graph
                object_data.main.umap.name_adata = name_adata // update the name of the current dataset
                object_data.main.umap.flag_all_tissues = str_tissue == 'All'; // flag indicating whether UMAP coordinates of all tissues are used.
                let dictarr = object_data.file.dict_name_file_to_parsed_data[ "cells." + name_adata + ".tsv.gz.base64.txt" ];
                if ( object_data.main.umap.flag_all_tissues ) {
                    object_data.main.umap.dictarr = dictarr;
                } else {
                    // build a boolean index for retrieving UMAP coordinates (and other data) for the current tissue
                    let l_tissue = dictarr[ "tissue" ],
                        l_bool_index = [ ],
                        i = 0;
                    for ( i = 0; i < l_tissue.length; i ++ ) {
                        l_bool_index.push( l_tissue[ i ] == str_tissue );
                    }
                    object_data.main.umap.l_bool_index_tissue = l_bool_index;
                    object_data.main.umap.dictarr = DictArrBooleanIndexing( dictarr, l_bool_index );
                }
            }
            // Update coordinates of scatter plots
            // draw cell annotation plot
            PlotCellAnnotation( );
            // draw expression plot
            await UpdateGene( );
            
            console.log( "[Change_UMAP_Coordinate] resolved" );
            Loading_Screen( false );
            resolve( "[Change_UMAP_Coordinate] resolved" );
        });
    }
    // preprocessing functions for updating caches
    function preprocess_expr( data ) {
        let str_key = Object.keys( data )[ 0 ];
        return ArrayMultiply( data[ str_key ], Math.pow( 0.1, object_data.setting.expression.n_digits_below_floating_point ) );
    }
    var plotPreviewGene = document.getElementById( "plotly_searchbox_main_preview" ),
        plotSingleCellAnnotation = document.getElementById( "plotly_sclncrna_expression_umap_annotation" ),
        plotSingleCellExpression = document.getElementById( "plotly_sclncrna_expression_umap_expression" ),
        plotSingleCellExpressionViolin = document.getElementById( "plotly_sclncrna_expression_violin" );
    object_data.setting.plot.single_cell_scatter = { 
        max_height: 750,
        marker_size: 1,
        int_factor_axis_range_to_marker_size : 15, 
        int_factor_marker_size_multiply : 1
    }; // defsult single-cell scatter plot setting
    object_data.setting.plot.single_cell_violin = { };
    var config_plotly = { responsive: true, displaylogo: false, toImageButtonOptions: { hoverClosestCartesian: true, format: 'png', filename: name_application, height: 750, width: 1100, scale: 1 }, modeBarButtonsToRemove: [ 'autoScale2d', 'toggleSpikelines', 'hoverCompareCartesian', 'hoverClosestCartesian' ] } // flexible plot width according to the window size  // do not display plotly logo
    function SortViolinTrace_Expression( trace_a, trace_b ) { return - ( trace_a.mean_expression_for_sorting - trace_b.mean_expression_for_sorting ) } // Sort Plotly Violin traces displaying expression values based on parameter values
// assign color to violine plot traces
    function String_Check_Substring( string, l_substring ) {
        let flag_contains_substring = false;
        string = string.toLowerCase( );
        for ( let i = 0; i < l_substring.length; i ++ ) {
            let substring = l_substring[ i ].toLowerCase( );
            if ( string.includes( substring ) ) {
                flag_contains_substring = true;
                break;
            }
        }
        return flag_contains_substring;
    }
    function PlotExpression_scRNA_Seq_Get_Color_for_name_clus( str_name_clus ) { // return color for the given str_name_clus
        str_name_clus = str_name_clus.toLowerCase( ); // convert name_clus to lower cases
        let color = "#48D1CC"
        if ( String_Check_Substring( str_name_clus, [ 'platelet' ] ) ) {
            color = "#aec2c1";
        } else if ( String_Check_Substring( str_name_clus, [ 'mast cell' ] ) ) {
            color = "#ceb3fc";
        } else if ( String_Check_Substring( str_name_clus, [ 'uninfected' ] ) ) {
            color = "#9ef274";
        } else if ( String_Check_Substring( str_name_clus, [ 'infected' ] ) ) {
            color = "#ff6b6b";
        } else if ( String_Check_Substring( str_name_clus, [ 'rbc' ] ) ) {
            color = "#fc4970";
        } else if ( String_Check_Substring( str_name_clus, [ 'endo', 'lymphatic', 'endotheli', 'capillary', 'luminal' ] ) ) {
            color = "#faf75f";
        } else if ( String_Check_Substring( str_name_clus, [ 'dendritic', 'pdc', 'cdc', 'dc_', ' dcs' ] ) ) {
            color = "#64b9fa";
        } else if ( String_Check_Substring( str_name_clus, [ 'stromal', 'fibroblasts', 'fibs', 'mesenchyme', 'cartilage' ] ) ) {
            color = "#fa5f5f";
        } else if ( String_Check_Substring( str_name_clus, [ 'goblet', 'ciliated', 'secretory', 'ionocyte', 'club' ] ) ) {
            color = "#fce6b6";
        } else if ( String_Check_Substring( str_name_clus, [ 'alveolar', 'basal', 'squamous', 'epithelia' ] ) ) {
            color = "#ffbad9";
        } else if ( String_Check_Substring( str_name_clus, [ 'tcell', 't cell', 't_cell', 't_', 'gd t', 'cd8', 'cd4', 'treg' ] ) ) {
            color = "#b89eff";
        } else if ( String_Check_Substring( str_name_clus, [ 'mono', 'lymphoid', 'hematopo', 'leukocyt', 'immuno', 'monocyte', 'neutrop', 'macro', 'b_cell', 'b cell', 'plasma cell', 'nk', 'eosinophil', 'naive' ] ) ) {
            color = "#e79eff";
        } else if ( String_Check_Substring( str_name_clus, [ 'myo' ] ) ) {
            color = "#e8a78b";
        }
        return color;
    }
    async function ChangeAnnotation( ) {
        // retrieve str_name_data_annotation from the current setting
        object_data.main.umap.str_name_data_annotation = Select_Get_Selected_Option_Using_ID( "select_umap_annotation_data" ).value
        
        // change annotations
        PlotCellAnnotation( flag_restyle = true ) // update UMAP annotation plot
        UpdateGene( flag_restyle = true ) // update gene expression (violin plots)
        PreviewGene( object_data.main.gene.gene_symbol ); // update box plot data for the current annotation
    }
    
    async function UpdateGene( flag_restyle = false ) { // draw a new plot by default
        console.log( "[UpdateGene] updating gene started" );
        let str_tissue = object_data.main.umap.tissue, // retrieve current tissue
            gene_symbol = object_data.main.gene.gene_symbol;
        
        // update plot (Single Cell Expression)
        // update cache of expression data
        let object_cache = object_data.main.gene.expr;
        await UpdateCache( object_cache, preprocess_expr, [ gene_symbol ] ); // retrieve the single cells expression data of the current gene.

        plotSingleCellExpression.style.height = Math.min( plotSingleCellExpression.offsetWidth, object_data.setting.plot.single_cell_scatter.max_height ) + 'px'; // responsive height ( width = height )
    
        let dictarr = object_data.main.umap.dictarr,
            l_expr = object_data.main.gene.expr.data[ gene_symbol ].data,
            col_name_cell_type = 'cell_type';
        if ( ! object_data.main.umap.flag_all_tissues ) {
            l_expr = ArrayBooleanIndexing( l_expr, object_data.main.umap.l_bool_index_tissue );
            col_name_cell_type = 'tissue_cell_type';
        }
        // update x-axis values from gene expression data
        if ( object_data.main.scatter.x_axis_col_name == '__x_axis_gene_expr__' ) {
            let gene_symbol_x_axis = object_data.main.scatter.x_axis_option,
                l_expr_x_axis = [ ];
            await UpdateCache( object_cache, preprocess_expr, [ gene_symbol_x_axis ] ); // retrieve the single cells expression data of the current gene.
            l_expr_x_axis = object_data.main.gene.expr.data[ gene_symbol_x_axis ].data;
            if ( ! object_data.main.umap.flag_all_tissues ) {
                l_expr_x_axis = ArrayBooleanIndexing( l_expr_x_axis, object_data.main.umap.l_bool_index_tissue );
            }
            dictarr[ '__x_axis_gene_expr__' ] = l_expr_x_axis;
        } else {
            object_data.main.scatter.x_axis_col_name = ( object_data.main.umap.flag_all_tissues ) ? 'UMAP_1' : 'tissue_UMAP_1';
        }
        if ( object_data.main.scatter.y_axis_col_name == '__y_axis_gene_expr__' ) {
            let gene_symbol_y_axis = object_data.main.scatter.y_axis_option,
                l_expr_y_axis = [ ];
            await UpdateCache( object_cache, preprocess_expr, [ gene_symbol_y_axis ] ); // retrieve the single cells expression data of the current gene.
            l_expr_y_axis = object_data.main.gene.expr.data[ gene_symbol_y_axis ].data;
            if ( ! object_data.main.umap.flag_all_tissues ) {
                l_expr_y_axis = ArrayBooleanIndexing( l_expr_y_axis, object_data.main.umap.l_bool_index_tissue );
            }
            dictarr[ '__y_axis_gene_expr__' ] = l_expr_y_axis;
        } else {
            object_data.main.scatter.y_axis_col_name = ( object_data.main.umap.flag_all_tissues ) ? 'UMAP_2' : 'tissue_UMAP_2';
        }
        // complete the selection process by re-enabling the selection button
        $id( 'select_scatter_x_axis' ).disabled = false; 
        $id( 'select_scatter_y_axis' ).disabled = false; 
        object_data.setting.plot.single_cell_scatter.int_factor_axis_range_to_marker_size = object_data.main.scatter.flag_axis_using_gene_expr ? 7 : 30;
        object_data.setting.plot.single_cell_scatter.marker_size = ResponsiveMarkerSize( plotSingleCellAnnotation, object_data.setting.plot.single_cell_scatter.int_factor_axis_range_to_marker_size, object_data.setting.plot.single_cell_scatter.int_factor_marker_size_multiply );
        if ( flag_restyle ) { // restyle existing plot
            console.log( "[UpdateGene] restyling existing plot for", gene_symbol );
            let update = { 
                hovertemplate: ["Expression of <b>" + gene_symbol + "</b>: <b>%{marker.color:.3f}</b>",
                                "cluster: <b>%{customdata[0]}</b>",
                                "cell type: <b>%{customdata[2]}</b>",
                                "tissue: <b>%{customdata[1]}</b>",
                                "",
                                object_data.main.scatter.x_label + ": <b>%{x:.2f}</b>",
                                object_data.main.scatter.y_label + ": <b>%{y:.2f}</b>",
                                "%{customdata[3]}",
                                "<extra></extra>" ].join( "<br>" ),
                marker: { 
                    color: l_expr,
                    showscale: true,
                    colorscale: "YlOrRd",
                    reversescale: true,
                    size: object_data.setting.plot.single_cell_scatter.marker_size
                } };
            Plotly.restyle( plotSingleCellExpression, update, [ 0 ] );
        } 
        else { // draw a new plot
            let trace = {
                mode: 'markers',
                type: 'scattergl',
                x: dictarr[ object_data.main.scatter.x_axis_col_name ],
                y: dictarr[ object_data.main.scatter.y_axis_col_name ],
                customdata: ArrayTranspose( [ dictarr[ 'name_cluster' ],
                                              dictarr[ "tissue" ],
                                              dictarr[ "cell_type" ],
                                              dictarr[ 'cell_barcode' ]
                                            ] ),
                hovertemplate: ["Expression of <b>" + gene_symbol + "</b>: <b>%{marker.color:.3f}</b>",
                                "cluster: <b>%{customdata[0]}</b>",
                                "cell type: <b>%{customdata[2]}</b>",
                                "tissue: <b>%{customdata[1]}</b>",
                                "",
                                object_data.main.scatter.x_label + ": <b>%{x:.2f}</b>",
                                object_data.main.scatter.y_label + ": <b>%{y:.2f}</b>",
                                "%{customdata[3]}",
                                "<extra></extra>" ].join( "<br>" ),
                marker: { 
                    color: l_expr,
                    showscale: true,
                    colorscale: "YlOrRd",
                    reversescale: true,
                    size: object_data.setting.plot.single_cell_scatter.marker_size
                },
                line: { 
                    width: 0
                },
            };
            let int_num_px_umap_graph = parseInt( $id( 'input_plot_height_UMAP' ).value ); // retrieve umap graph size from the setting
            Plotly.newPlot( plotSingleCellExpression, [ trace ], { margin: { l: 65, r: 65, b: 90, t: 50, pad: 4 }, xaxis: { title : object_data.main.scatter.x_label, zeroline: false }, yaxis: { title : object_data.main.scatter.y_label, zeroline: false }, hovermode: "closest" }, { ... config_plotly, filename: name_application + '__Expression_of_' + gene_symbol, height: int_num_px_umap_graph, width: int_num_px_umap_graph } ); // draw scatter plot of the annotation
            plotSingleCellExpression.on( "plotly_relayout" , function( ed ) {
                PlotlySynchronizedLayout( ed, l_div_plotly );
            });
            plotSingleCellExpression.on( 'plotly_click', async function( data ) {
                PlotlyCallBackSingleCellMarker( data.points[ 0 ] ); // open single cell marker for the first data
            });
        }
//         // Update correlated genes 
        
//         object_cache = object_data.main.gene.correl;
//         await UpdateCache( object_cache, null, [ gene_symbol ] ); // update cache of correlated gene data
//         Display_DataTable( 'container_datatable_correl', 'datatable_correl', object_cache.data[ gene_symbol ].data, [ "gene_symbol", "correlation_coefficient", "probability" ] );
//         // change panel name
//         document.getElementById( "panel_name_correl_gene").innerHTML = "Co-Expressed Genes of " + gene_symbol;
//         // change datatable name 
//         object_data.main.datatable[ 'datatable_correl' ].name = `correl_gene.${gene_symbol}`;
//         // show datatable panel
//         $( "#container_panel_datatable_correl" ).collapse( 'show' )
        
        // Update interaction graph
//         LoadRemoteTextFile( "http://www.rna-society.org/rnainter/php_mysql/api.php?keyword=Actb&species=Mus musculus" )
        
        // Violin plots
        object_data.setting.plot.single_cell_violin.ignore_cells_with_zero_counts = ! document.getElementById( "checkbox__plotly_sclncrna_expression_violin__ignore_cells_with_zero_counts" ).checked; // retrieve current setting
        
        // retrieve str_name_data_annotation from the current setting
        let str_name_data_annotation = Select_Get_Selected_Option_Using_ID( "select_umap_annotation_data" ).value;
        object_data.main.umap.str_name_data_annotation = str_name_data_annotation;
        
        // build list of traces for each category
        dictarr = Pivot( object_data.main.umap.dictarr[ str_name_data_annotation ], l_expr ); // key = cluster, value = list of expression values.
        let trace_template = { 
            type: 'violin',
            opacity: 0.6,
            box: { visible: true, width: 0.075 },
            meanline: { visible: true }
        },
            l_category = Object.keys( dictarr ),
            str_separation = ( plotSingleCellExpressionViolin.offsetWidth > 3000 ) ? '<br>' : ' ' ; // set 'str_separation' based on current width to increase responsiveness of the plot
        let l_trace = [ ];
        for ( let category in dictarr ) {
            let l_expr = dictarr[ category ],
                n_cells = l_expr.length, // retrieve number of cells for the current category
                n_ceels_original = object_data.setting.plot.annotation.dict_tissue_to_dict_name_col_to_dict_class_to_num_cells[ str_tissue ][ str_name_data_annotation ][ category ],
                float_mean_expression = ArrayAverage( l_expr ), // retrieve a mean expression of cells for the current trace
                object_RemoveNegativeCells = RemoveNegativeCells( l_expr ), // retrieve list of expression values excluding cells with zero counts
                n_cells_with_zero_count = object_RemoveNegativeCells.n_cells_nagative,
                l_expr_without_negative_cells = object_RemoveNegativeCells.l_expr_without_negative_cells;

            let trace = { ... trace_template,
                         x0: "", 
                         y: [ ],
                         name: category,
                         line: { color: 'black', width: 2 },
                         fillcolor: object_data.setting.plot.annotation.dict_tissue_to_dict_name_col_to_dict_class_to_color[ str_tissue ][ str_name_data_annotation ][ category ],
                         points: false, // do not show outliers to increase responsivity
                         y_ignore_cells_with_zero_counts__true: l_expr_without_negative_cells,
                         y_ignore_cells_with_zero_counts__false: ArrayFull( n_cells_with_zero_count, 0 ).concat( l_expr_without_negative_cells ),
                         x0_ignore_cells_with_zero_counts__true: category + str_separation + "(n=" + ( n_cells - n_cells_with_zero_count ) + ' of ' + n_cells + ( n_cells == n_ceels_original ? '' : '/' + n_ceels_original ) + ')',
                         x0_ignore_cells_with_zero_counts__false: category + str_separation + "(n=" + n_cells + ( n_cells == n_ceels_original ? '' : '/' + n_ceels_original ) + ')',
                         mean_expression_for_sorting: float_mean_expression
                        };
            l_trace.push( trace );
        }
        l_trace = l_trace.sort( SortViolinTrace_Expression ); // sort by mean expression
        let layout = {
            margin: { l: 50, r: 65, b: 150, t: 50, pad: 4 },
            yaxis: { title : "Normalized Expression", rangemode: "nonnegative" },
            legend: { tracegroupgap: 0 },
            violingap: 0, // split violin plot for two covid statuses
            violingroupgap: 0,
            violinmode: "overlay",
        }
        for ( let i = 0; i < l_trace.length; i ++ ) { // swap y and x0 values based on the 'object_plot_scrnaseq.option.ignore_cells_with_zero_counts' setting
            l_trace[ i ].x0 = object_data.setting.plot.single_cell_violin.ignore_cells_with_zero_counts ? l_trace[ i ].x0_ignore_cells_with_zero_counts__true : l_trace[ i ].x0_ignore_cells_with_zero_counts__false ;
            l_trace[ i ].y = object_data.setting.plot.single_cell_violin.ignore_cells_with_zero_counts ? l_trace[ i ].y_ignore_cells_with_zero_counts__true : l_trace[ i ].y_ignore_cells_with_zero_counts__false ;
        }
        Plotly.newPlot( plotSingleCellExpressionViolin, l_trace, layout, { ... config_plotly, filename: name_application + '__Expression_of_' + gene_symbol, height: 600, width: 1100 } );
    }
    object_data.setting.plot.annotation = { };
    object_data.setting.plot.annotation.dict_tissue_to_dict_name_col_to_dict_class_to_color = { 'All' : { 'name_cluster' : { 'c1' : '#7FC2E9', 'c2' : '#77A0D4', 'c3' : '#4F91C0', 'c4' : '#4586B3', 'c5' : '#3589B4', 'c6' : '#146AA5', 'c7' : '#156BA1', 'c8' : '#0B5687', 'c9' : '#F4F4C1', 'c10' : '#EFE6A3', 'c11' : '#F7DD90', 'c12' : '#F4BE51', 'c13' : '#F2942F', 'c14' : '#E16C1A', 'c15' : '#C14D1D', 'c16' : '#862F21', 'c17' : '#5E2014', 'c18' : '#8892BF', 'c19' : '#9D86B5', 'c20' : '#9175B3', 'c21' : '#805FA6', 'c22' : '#7F3E93', 'c23' : '#791C74', 'c24' : '#431F45', 'c25' : '#56B091', 'c26' : '#4BB355', 'c27' : '#1C8544', 'c28' : '#136A36', 'c29' : '#02351B', 'c30' : '#935424', 'c31' : '#B7761C', 'c32' : '#B99132', 'c33' : '#A88937', 'c34' : '#9D733F', 'c35' : '#A9A9A9', 'discarded' : '#A9A9A9' }, 'cell_type' : { 'Endothelium' : '#D9CD97', 'Epithelium' : '#C55044', 'Fibroblast' : '#6F89A8', 'Lymphocyte' : '#556F60', 'Myeloid' : '#534C7D', 'Plasma' : '#8A7148' }, 'group' : { 'Normal' : '#805FA6', 'Adjacent' : '#4F91C0', 'Tumor' : '#F2942F' }, 'tissue' : { 'lung' : '#54A894', 'PDAC' : '#9ACFC2', 'Bladder' : '#B7A48F', 'colorectal' : '#ECA289', 'thyroid' : '#8B6F57', 'gastric' : '#DD6043', 'breast' : '#515F8C', 'prostate' : '#D23B27', 'ICC' : '#68B9CE', 'ovarian' : '#8E98B6', 'liver' : '#68B9CE' }, 'gender' : { 'F': '#8774c2', 'M': '#e44a1b' }, 'disease' : { 'prostate-cancer': '#401a51', 'ovarian-cancer': '#5e195b', 'breast-cancer': '#4c3adf', 'colorectal-cancer': '#87537a', 'Pca': '#2c5f9d', 'ADC': '#77c425', 'ADC(Double)': '#b42e9a', 'Intrahepatic-cholangiocarcinoma': '#fde4ea', 'Squamous-': '#c8691d', 'Adenomatous': '#3872d1', 'Large-cell': '#000646', 'Squamous': '#9f79c4', 'Pleiomorphic': '#c53426', 'normal-pancreas/mucinous-cystic-neoplasia-': '#3b9249', 'normal-pancreas/choledochal-neuroendocrine-tumors': '#0b4887', 'normal-pancreas/solid-pseudopapillary-tumor': '#87a507', 'normal-pancreas/small intestine papillary adenocarinoma': '#163502', 'normal-pancreas/duodenal-intraepithelial-neoplasia': '#b77609', 'normal-pancreas/pancratic-neuroendocrine-tumor': '#bdc979', 'normal-pancreas/serous-cystic-neoplasia': '#682404', 'moderately-poorly-differentiated-PDAC': '#5c1006', 'poorly-differentiated-PDAC': '#8a2706', 'well-differentiated-PDAC': '#8e6429', 'moderately-differentiated-PDAC': '#2bcb1d', 'well-moderately-differentiated-PDAC': '#4a452f', 'PDAC': '#5e8c36', 'bladder-urothelial-tumor': '#bb264f', 'control': '#6394f8', 'thyroid-cancer': '#91d27a', 'Adenocarcinoma': '#9d3c1f', 'Severe-intestinal-metaplasia-,-mild-atrophy,-no-dysplasia': '#9198b1' }, 'cancer_stage' : { 'IA': '#b8e64a', 'IB': '#e77800', 'IIA': '#a35700', 'IIIA': '#d0919e', 'IA3': '#f94f9d', 'III': '#32cbcf', 'II': '#be67ee', 'IIIB': '#f55347', 'IIB': '#2b5e29', 'normal': '#8a5504', 'high-grade': '#53cab9', 'low-grade': '#f02235', 'IVB': '#93c066', 'IVC': '#801cb8', 'I': '#296bf2', 'Invasive adenocarcarcinoma with mucinous and signet ring features': '#ab86fc', 'Diffuse poorly cohesive adenocarcinoma with signet ring features': '#5a68c0', 'Intestinal invasive adenocarcinoma ': '#d3fbab', 'Intestinal adenocarcinoma': '#6f2dc8', 'Mixed intestinal poorly cohesive adenocarcinoma with signet ring component': '#4cd963' }, 'sampling_site' : { 'normal tissue adjacent to neoplasm ': '#178da0', 'normal tissue adjacent to neoplasm': '#9aec7c', 'neoplasm': '#72f6e3', 'neoplasm core': '#a9b77f', 'neoplasm border': '#9b7baf', 'nLung': '#8efdde', 'tLung': '#ea89a5', 'normal': '#663536', 'tumor': '#747294', 'core': '#2bbc14', 'middle': '#9375c1', 'edge': '#5ed157', 'tail': '#855b8d', 'common bile duct': '#68beba', 'body': '#861ce2', 'descending duodenum': '#c2482e', 'body and tail': '#0302b6', 'uncinate process': '#049734', 'head': '#814130', 'adjacent normal mucosae': '#7ddc1f', 'GEJ+stomach': '#0cbda0', 'Body ': '#e85033', 'Gastric': '#062052', 'Body and antrum invovled': '#131ccc', 'GEJ': '#b098db', 'lower esophagus: center is 0.2 cm above GEJ': '#21de80', 'lower esophagus: center is 0.3 cm above GEJ': '#5e83e9', 'Cardia GEJ': '#8b4e90', 'Body lesser curve': '#cd558d' } } }; // define color for each cell type // currently color and cluster annotation for c0, c1, c2 are uncertain (need to receive a correct Rds file)
    // number of cells for each class
    object_data.setting.plot.annotation.dict_tissue_to_dict_name_col_to_dict_class_to_num_cells = { 'All' : {'group': {'Tumor': 528811, 'Normal': 162627, 'Adjacent': 146950}, 'tissue': {'lung': 207411, 'PDAC': 165197, 'bladder': 85384, 'colorectal': 62203, 'thyroid': 60768, 'gastric': 59874, 'breast': 43751, 'prostate': 43193, 'ICC': 42609, 'ovarian': 41094, 'liver': 26904}, 'cell_type': {'Epithelium': 268469, 'Lymphocyte': 202077, 'Myeloid': 151298, 'Fibroblast': 104804, 'Endothelium': 74102, 'Plasma': 37638}, 'name_cluster': {'c35': 268469, 'c18': 41108, 'c9': 36175, 'c10': 35815, 'c11': 32858, 'c19': 32218, 'c12': 29697, 'c1': 28802, 'c25': 27011, 'c20': 23737, 'c2': 22889, 'c21': 22059, 'c26': 21615, 'c13': 19824, 'c3': 19059, 'c22': 17650, 'c4': 16164, 'c14': 16008, 'c27': 15036, 'c5': 14742, 'c23': 12981, 'c15': 12052, 'c16': 11504, 'c28': 10392, 'c17': 8144, 'c29': 8057, 'c30': 7585, 'c31': 6537, 'c32': 6257, 'c33': 4982, 'c34': 4220, 'c24': 1545, 'c6': 1363, 'c7': 1186, 'c8': 487, 'discarded': 160}, 'disease': {'na': 162627, 'ADC': 75298, 'thyroid-cancer': 46623, 'moderately-poorly-differentiated-PDAC': 44114, 'breast-cancer': 43751, 'bladder-urothelial-tumor': 43681, 'Intrahepatic-cholangiocarcinoma': 42609, 'ovarian-cancer': 41094, 'colorectal-cancer': 39954, 'Adenomatous': 39450, 'Adenocarcinoma': 33632, 'prostate-cancer': 30711, 'moderately-differentiated-PDAC': 22393, 'Large-cell': 18878, 'normal-pancreas/solid-pseudopapillary-tumor': 15739, 'control': 14737, 'Pleiomorphic': 14640, 'normal-pancreas/mucinous-cystic-neoplasia-': 13485, 'well-moderately-differentiated-PDAC': 13042, 'ADC(Double)': 12360, 'poorly-differentiated-PDAC': 9765, 'well-differentiated-PDAC': 8378, 'PDAC': 7727, 'Pca': 7316, 'Squamous': 6271, 'normal-pancreas/small intestine papillary adenocarinoma': 5924, 'normal-pancreas/pancratic-neuroendocrine-tumor': 5049, 'Severe-intestinal-metaplasia-,-mild-atrophy,-no-dysplasia': 4671, 'Squamous-': 4153, 'normal-pancreas/choledochal-neuroendocrine-tumors': 4140, 'normal-pancreas/serous-cystic-neoplasia': 3570, 'normal-pancreas/duodenal-intraepithelial-neoplasia': 2606}, 'cancer_stage': {'na': 335778, 'IIB': 68595, 'normal': 65250, 'IB': 59152, 'II': 52523, 'IA': 47969, 'III': 37532, 'IA3': 27347, 'IIIA': 26514, 'high-grade': 23824, 'IIA': 22320, 'low-grade': 19857, 'IIIB': 14792, 'Intestinal invasive adenocarcinoma ': 9389, 'Diffuse poorly cohesive adenocarcinoma with signet ring features': 6101, 'Invasive adenocarcarcinoma with mucinous and signet ring features': 5774, 'I': 5128, 'Intestinal adenocarcinoma': 3443, 'Mixed intestinal poorly cohesive adenocarcinoma with signet ring component': 3271, 'IVB': 2378, 'IVC': 1451}, 'gender': {'na': 328266, 'F': 293731, 'M': 216391}, 'sampling_site': {'na': 239961, 'neoplasm': 128818, 'head': 47679, 'tLung': 44778, 'nLung': 42880, 'normal': 39416, 'body': 30175, 'tumor': 28665, 'body and tail': 25694, 'normal tissue adjacent to neoplasm': 21329, 'edge': 20828, 'middle': 19445, 'core': 17647, 'tail': 17518, 'adjacent normal mucosae': 14737, 'neoplasm core': 14664, 'uncinate process': 14469, 'neoplasm border': 12781, 'descending duodenum': 8530, 'Gastric': 8513, 'Body ': 6101, 'normal tissue adjacent to neoplasm ': 5931, 'GEJ+stomach': 5774, 'Body lesser curve': 4671, 'lower esophagus: center is 0.3 cm above GEJ': 4241, 'common bile duct': 4140, 'Body and antrum invovled': 3443, 'GEJ': 3271, 'lower esophagus: center is 0.2 cm above GEJ': 1413, 'Cardia GEJ': 876} } }
    
    async function PlotCellAnnotation( flag_restyle = false ) { // draw a new plot by default
        let str_tissue = object_data.main.umap.tissue, // retrieve current tissue
            option_selected = Select_Get_Selected_Option_Using_ID( "select_umap_annotation_data" ),
            str_name_data_annotation = option_selected.value, // retrieve name of data for annotations
            str_name_option_selected = option_selected.innerHTML; // retrieve the name of the selected option
        
        plotSingleCellAnnotation.style.height = Math.min( plotSingleCellAnnotation.offsetWidth, object_data.setting.plot.single_cell_scatter.max_height ) + 'px'; // responsive height ( width = height )
        // demonstration
        let object_cache = object_data.main.gene.expr;
        let dictarr = object_data.main.umap.dictarr, 
            col_name_cell_type = ( object_data.main.umap.flag_all_tissues ) ? 'cell_type' : 'tissue_cell_type',
            l_color = [ ], marker_colormap = { }, str_hovertemplate_additional_line = '';
        // set color 
        switch( str_name_data_annotation ) {
          case 'name_cluster':
          case 'cell_type':
          case 'gender':
          case 'disease':
          case 'cancer_stage':
          case 'sampling_site':
          case 'tissue':
          case 'group':
            l_color = ArrayMap( dictarr[ str_name_data_annotation ], object_data.setting.plot.annotation.dict_tissue_to_dict_name_col_to_dict_class_to_color[ str_tissue ][ str_name_data_annotation ], '#A9A9A9' ); // default color is '#A9A9A9'
            break;
          default:
            l_color = dictarr[ str_name_data_annotation ];
            marker_colormap = { showscale: true, colorscale: "YlOrRd", reversescale: true }; // setting for showing colormap
            str_hovertemplate_additional_line = "<b>" + str_name_option_selected + "</b>: <b>%{marker.color:." + ( ( str_name_option_selected == 'MT Percentage' ) ? 1 : 0 ).toString( ) + "f}</b><br>"; // only MT percentage data will be shown as floating point numbers
            break;
        }
        // update x-axis values from gene expression data
        if ( object_data.main.scatter.x_axis_col_name == '__x_axis_gene_expr__' ) {
            let gene_symbol_x_axis = object_data.main.scatter.x_axis_option,
                l_expr_x_axis = [ ];
            await UpdateCache( object_cache, preprocess_expr, [ gene_symbol_x_axis ] ); // retrieve the single cells expression data of the current gene.
            l_expr_x_axis = object_data.main.gene.expr.data[ gene_symbol_x_axis ].data;
            if ( ! object_data.main.umap.flag_all_tissues ) {
                l_expr_x_axis = ArrayBooleanIndexing( l_expr_x_axis, object_data.main.umap.l_bool_index_tissue );
            }
            dictarr[ '__x_axis_gene_expr__' ] = l_expr_x_axis;
        } else {
            object_data.main.scatter.x_axis_col_name = ( object_data.main.umap.flag_all_tissues ) ? 'UMAP_1' : 'tissue_UMAP_1';
        }
        if ( object_data.main.scatter.y_axis_col_name == '__y_axis_gene_expr__' ) {
            let gene_symbol_y_axis = object_data.main.scatter.y_axis_option,
                l_expr_y_axis = [ ];
            await UpdateCache( object_cache, preprocess_expr, [ gene_symbol_y_axis ] ); // retrieve the single cells expression data of the current gene.
            l_expr_y_axis = object_data.main.gene.expr.data[ gene_symbol_y_axis ].data;
            if ( ! object_data.main.umap.flag_all_tissues ) {
                l_expr_y_axis = ArrayBooleanIndexing( l_expr_y_axis, object_data.main.umap.l_bool_index_tissue );
            }
            dictarr[ '__y_axis_gene_expr__' ] = l_expr_y_axis;
        }  else {
            object_data.main.scatter.y_axis_col_name = ( object_data.main.umap.flag_all_tissues ) ? 'UMAP_2' : 'tissue_UMAP_2';
        }
        // complete the selection process by re-enabling the selection button
        $id( 'select_scatter_x_axis' ).disabled = false; 
        $id( 'select_scatter_y_axis' ).disabled = false; 
        object_data.setting.plot.single_cell_scatter.int_factor_axis_range_to_marker_size = object_data.main.scatter.flag_axis_using_gene_expr ? 7 : 30;
        object_data.setting.plot.single_cell_scatter.marker_size = ResponsiveMarkerSize( plotSingleCellAnnotation, object_data.setting.plot.single_cell_scatter.int_factor_axis_range_to_marker_size, object_data.setting.plot.single_cell_scatter.int_factor_marker_size_multiply );
        if ( flag_restyle ) { // restyle existing plot
            console.log( "[PlotCellAnnotation] restyling existing plot for", str_name_data_annotation );
            let update = {
                hovertemplate: [ str_hovertemplate_additional_line + "cluster: <b>%{customdata[0]}</b>",
                                "cell type: <b>%{customdata[1]}</b>",
                                "tissue: <b>%{customdata[2]}</b>",
                                "",
                                object_data.main.scatter.x_label + ": <b>%{x:.2f}</b>",
                                object_data.main.scatter.y_label + ": <b>%{y:.2f}</b>",
                                "%{customdata[3]}",
                                "<extra></extra>" ].join( "<br>" ),
                marker: { 
                    color: l_color,
                    size: object_data.setting.plot.single_cell_scatter.marker_size
                } };
            update.marker = { ... update.marker, ... marker_colormap }; // update setting for showing colormap
            Plotly.restyle( plotSingleCellAnnotation, update, [ 0 ] );
        } 
        else {
            let trace = {
                mode: 'markers',
                type: 'scattergl',
                x: dictarr[ object_data.main.scatter.x_axis_col_name ],
                y: dictarr[ object_data.main.scatter.y_axis_col_name ],
                customdata: ArrayTranspose( [ dictarr[ 'name_cluster' ],
                                              dictarr[ 'cell_type' ],
                                              dictarr[ "tissue" ],
                                              dictarr[ 'cell_barcode' ]
                                            ] ),
                hovertemplate: [ str_hovertemplate_additional_line + "cluster: <b>%{customdata[0]}</b>",
                                "cell type: <b>%{customdata[1]}</b>",
                                "tissue: <b>%{customdata[2]}</b>",
                                "",
                                object_data.main.scatter.x_label + ": <b>%{x:.2f}</b>",
                                object_data.main.scatter.y_label + ": <b>%{y:.2f}</b>",
                                "%{customdata[3]}",
                                "<extra></extra>" ].join( "<br>" ),
                marker: { 
                    color: l_color,
                    size: object_data.setting.plot.single_cell_scatter.marker_size            
                },
                line: { 
                    width: 0
                },
            };
            trace.marker = { ... trace.marker, ... marker_colormap }; // update setting for showing colormap
            let int_num_px_umap_graph = parseInt( $id( 'input_plot_height_UMAP' ).value ); // retrieve umap graph size from the setting
            Plotly.newPlot( plotSingleCellAnnotation, [ trace ], { margin: { l: 65, r: 65, b: 90, t: 50, pad: 4 }, xaxis: { title : object_data.main.scatter.x_label, zeroline: false }, yaxis: { title : object_data.main.scatter.y_label, zeroline: false }, hovermode: "closest" }, { ... config_plotly, filename: name_application + '__Annotation', height: int_num_px_umap_graph, width: int_num_px_umap_graph } ); // draw scatter plot of the annotation
            
            // add interactions
            plotSingleCellAnnotation.on( 'plotly_click', async function( data ) {
                PlotlyCallBackSingleCellMarker( data.points[ 0 ] );
            });
            plotSingleCellAnnotation.on( "plotly_relayout" , function( ed ) {
                PlotlySynchronizedLayout( ed, l_div_plotly );
            });
        }
    }
    async function PlotlyCallBackSingleCellMarker( clicked_point ) { // load the cell-type marker gene table of the cell-type to which the clicked cell belongs
//         console.log( clicked_point );
        let index_point = clicked_point.pointIndex, dictarr = object_data.main.umap.dictarr;
        let str_name_cluster = dictarr[ "name_cluster" ][ index_point ], str_key = str_name_cluster;
        let object_cache = object_data.main.cell_marker;
        await UpdateCache( object_cache, null, [ str_key ] ); // update cache of cell marker data
        Display_DataTable( 'container_datatable_cell_marker', 'datatable_cell_marker', object_cache.data[ str_key ].data, [ 'cluster_name', 'gene_name', 'log2_fold_changes', 'p_val', 'corrected_p_val' ] );
        // change panel name
        document.getElementById( "panel_name_cellmarker").innerHTML = "Cell Marker Table for Cluster " + str_key;
        // change datatable name 
        object_data.main.datatable[ 'datatable_cell_marker' ].name = `cell_marker.cluster.${str_name_cluster}`;
        // show datatable panel
        $( "#container_panel_datatable_cell_marker" ).collapse( 'show' )
    }
    int_size_ResponsiveMarkerSize = 1; // temporary global variable for drawing graph with a fixed marker size 
    function ResponsiveMarkerSize( div, int_factor_axis_range_to_marker_size = 30, int_factor_marker_size_multiply = 3 ) { // get marker size according to the given parameter and x- and y-axis range of the division containing a plotly plot
        return int_size_ResponsiveMarkerSize;
        if ( ! ( 'layout' in div ) ) {
            return object_data.setting.plot.single_cell_scatter.marker_size; // if plotly has not been drawn, use the default value for the marker size
        }
        let x = div.layout.xaxis, y = div.layout.yaxis,
            int_marker_size_to_be_updated = Math.min( 10, Math.min( Math.ceil( int_factor_axis_range_to_marker_size / ( x.range[ 1 ] - x.range[ 0 ] ) ), Math.ceil( int_factor_axis_range_to_marker_size / ( y.range[ 1 ] - y.range[ 0 ] ) ) ) * int_factor_marker_size_multiply );
        return int_marker_size_to_be_updated;
    }
    // synchronization of zoom levels across plots
    function PlotlySynchronizedLayout( ed, divs ) {
        if ( Object.entries( ed ).length === 0 ) { return; }
        // broadcasting updated zoom level across plots
        divs.forEach( ( div, i ) => {
            let x = div.layout.xaxis, y = div.layout.yaxis, flag_relayout = false, update = { }; // a flag indicating whether a relayout event is required
            // ignore when layouts are changed due to autoranging
            let int_marker_size_current = div.data[ 0 ].marker.size;
                int_marker_size_to_be_updated = ResponsiveMarkerSize( div, object_data.setting.plot.single_cell_scatter.int_factor_axis_range_to_marker_size, object_data.setting.plot.single_cell_scatter.int_factor_marker_size_multiply ),
                flag_restyle = int_marker_size_to_be_updated != int_marker_size_current;

            if ( flag_restyle ) { // restyle existing plot
                console.log( "[UpdateGene] restyling marker size to ", int_marker_size_to_be_updated );
                let update = { marker : div.data[ 0 ].marker };
                update.marker.size = int_marker_size_to_be_updated;
                object_data.setting.plot.single_cell_scatter.marker_size = int_marker_size_to_be_updated; // update marker size
                Plotly.restyle( div, update, [ 0 ] );
            } 
            
            if ( ( ed[ "xaxis.autorange" ] && x.autorange ) && ( ed[ "yaxis.autorange" ] && y.autorange ) ) { 
                return;
            }
            // update x-axis
            if ( x.range[ 0 ] != ed[ "xaxis.range[0]" ] || x.range[ 1 ] != ed[ "xaxis.range[1]" ] ) {
                flag_relayout = true;
                update = { ... update, 'xaxis.range[0]': ed[ "xaxis.range[0]" ], 'xaxis.range[1]': ed[ "xaxis.range[1]" ], 'xaxis.autorange': ed[ "xaxis.autorange" ] };
            }
            // update y-axis
            if ( y.range[ 0 ] != ed[ "yaxis.range[0]" ] || y.range[ 1 ] != ed[ "yaxis.range[1]" ] ) {
                flag_relayout = true;
                update = { ... update, 'yaxis.range[0]': ed[ "yaxis.range[0]" ], 'yaxis.range[1]': ed[ "yaxis.range[1]" ], 'yaxis.autorange': ed[ "yaxis.autorange" ] };
            }
            if ( flag_relayout ) {
                Plotly.relayout( div, update ); // perform relayout operation
            }
            
        });
    }
    var l_div_plotly = [ plotSingleCellAnnotation, plotSingleCellExpression ];

    function Display_DataTable( id_datatable_container, id_datatable, dictarr, l_col_selected = null ) { // load datatable with loaded datasets
        let object_datatable = object_data.main.datatable[ id_datatable ], columns = [ ], dataSet = [ ], df = null, l_col = [ ];

        df = new DataFrame( dictarr );
        object_datatable.df = df; // save the reference to the dataframe
        if ( ! ( l_col_selected === null ) ) {
            df = df.select( ... l_col_selected ); // select appropriate columns before visualization
        }
        dataSet = df.toArray( ), l_col = df.listColumns( );
        for ( let i = 0; i < l_col.length; i ++ ) { columns.push( { title: l_col[ i ] } ); } // set columns for DataTable.js
        $( '#' + id_datatable_container ).empty( ); // empty the datatable and redraw the datatable
        $( '#' + id_datatable_container ).append( '<table id="' + id_datatable + '" class="display" width="100%"></table>' );
        $( '#' + id_datatable ).DataTable( { data: dataSet, columns: columns } ); // display the datatable
    }
    function Download_DataTable( id_datatable ) { // download analysis result of vaccine candidate as a csv file
        let string_csv_datatable = '', object_datatable = object_data.main.datatable[ id_datatable ], df = object_datatable.df;
        if ( df != null ) {
            string_csv_datatable = df.toCSV( true );
        }
        let blob = new Blob( [ string_csv_datatable ], { type: "text/plain;charset=utf-8" } );
        name_file = object_datatable.name + '.datatable.csv' // change the extension of the filename
        saveAs( blob, name_file ); // save file 
    }
    object_data.setting.plot.preview_gene = { };
    object_data.setting.plot.preview_gene.dict_category_to_color = {
        "Heart (n=5979)" : '#F8766D',
        "Intestine (n=2330)" : '#B79F00',
        "Kidney (n=2455)" : "#00BA38",
        "Lung (n=4375)" : "#619CFF",
        "Liver (n=4191)" : "#00BFC4",
        "Thymus (n=2914)" : "#F564E3",
    }; // define color for each tissue
    function SortBoxTrace( trace_a, trace_b ) { return - ( trace_a.q3 - trace_b.q3 ) } // Sort Plotly Boxplot traces based on parameter values
    object_data.main.preview_gene = { previous : { str_tissue : 'All', str_name_data_annotation : 'default', gene_symbol : 'default' } };
    async function PreviewGene( gene_symbol ) { // draw preview of expression of the current gene using boxplots
        // retrieve str_name_data_annotation from the current setting
        let str_name_data_annotation = object_data.main.umap.str_name_data_annotation,
            str_tissue = object_data.main.umap.tissue,
            previous = object_data.main.preview_gene.previous;
        
        // determine whether the plot should be drawn again
        if ( ( previous.str_tissue == str_tissue ) & ( previous.str_name_data_annotation == str_name_data_annotation ) & ( previous.gene_symbol == gene_symbol ) ) {
            console.log( '[PreviewGene] preview gene has been already drawn' );
            return - 1;
        }
        // save the current setting before drawing the graph
        object_data.main.preview_gene.previous = { str_tissue : str_tissue, str_name_data_annotation : str_name_data_annotation, gene_symbol : gene_symbol }
        
        let window_width = window.innerWidth,
            window_height = window.innerHeight,
            window_width_excluding_sidebar = $id( "controlBox_plotly_graph_main" ).offsetWidth,
            preview_height = parseInt( Math.min( Math.max( 175, window_height / 3.5 ), 500 ) ),
            preview_width = window_width_excluding_sidebar,
            div_preview = $id( "plotly_searchbox_main_preview" );
        div_preview.style.height = ( preview_height ).toString( ) + 'px';
        div_preview.style.width = ( preview_width ).toString( ) + 'px';
        
        // load and initialize box plot data 
        if ( ! ( 'gene_summary' in object_data.main ) || str_name_data_annotation != object_data.main.gene_summary.str_name_data_annotation ) { // if box plot data has not been parsed or annotation data has been changed, initialize the data
            // update box plot data if the given 'str_name_data_annotation' is valid
            if ( str_name_data_annotation in { 'name_cluster' : '', 'cell_type' : '', 'group' : '', 'tissue' : '', 'disease' : '', 'cancer_stage' : '' } ) {
                let name_file_box_plot_summary = "box_precomputed.multiplied_by_1000." + str_name_data_annotation + ".tsv.gz.base64.txt"; // retrieve the name of file for the current 'str_name_data_annotation'
                await LoadRemoteData( [ object_data.file.base_url + name_file_box_plot_summary ] );
                object_data.main.gene_summary = { };
                object_data.main.gene_summary.boxplot = { };
                object_data.main.gene_summary.boxplot.dictdictarr = SplitColumn( object_data.file.dict_name_file_to_parsed_data[ name_file_box_plot_summary ] );
                object_data.main.gene_summary.str_name_data_annotation = str_name_data_annotation; // update 'str_name_data_annotation'
            }
        }
        let index_gene = object_data.main.gene.expr.dict_key_to_index[ gene_symbol ][ 0 ],
            l_trace = [ ], dictdictarr = object_data.main.gene_summary.boxplot.dictdictarr;
        
        for ( let category in dictdictarr ) {
            let category_without_description = category.slice( 0, category.lastIndexOf( " (n=" ) ); // retrieve 'category_without_description' to apply colors to each graph
            let trace = { };
            trace.lowerfence = [ dictdictarr[ category ][ 'MIN' ][ index_gene ] / 1000 ]; // scale back to original expression scale (the data became integer during delivery to reduce its size)
            trace.q1 = [ dictdictarr[ category ][ 'Q1' ][ index_gene ] / 1000 ];
            trace.median = [ dictdictarr[ category ][ 'Q2' ][ index_gene ] / 1000 ];
            trace.q3 = [ dictdictarr[ category ][ 'Q3' ][ index_gene ] / 1000 ];
            trace.upperfence = [ dictdictarr[ category ][ 'MAX' ][ index_gene ] / 1000 ];
            trace.name = category;
            trace.line = { color: object_data.setting.plot.annotation.dict_tissue_to_dict_name_col_to_dict_class_to_color[ str_tissue ][ str_name_data_annotation ][ category_without_description ] }; // use pre-defined color for each tissue
            trace.type = 'box';
            trace.x0 = category;
            l_trace.push( trace );
        }
        l_trace = l_trace.sort( SortBoxTrace );
//         document.getElementById( "plotly_searchbox_main_preview" ).style.height = "350px";
        Plotly.newPlot( "plotly_searchbox_main_preview", l_trace, { margin: { l: 65, r: 65, b: 90, t: 50, pad: 4 }, yaxis: { title : "Relative Expression of " + gene_symbol } }, { filename: name_application + '__Preview_Expression_of_' + gene_symbol, height: preview_height, width: preview_width, ... config_plotly } ); // draw boxplot of expression of the gene 
    }
    function Toggle_Sidebar( ) {
        // toggle side menu
        let id_container = "#container_main_sidebar"
        if( $( id_container ).hasClass( 'toggled' ) ) { // when sidebar is shown
            $( id_container ).removeClass( 'toggled' ); // side sidebar
            button_open_sidebar.style.display = "block"; // show the button opening sidebar
        } else { // when sidebar is hidden
            $( id_container ).addClass( 'toggled' ); // show the sidebar
            button_open_sidebar.style.display = "none"; // hide the button opening sidebar
        }
    }
    $( "#container_main_sidebar" ).on( "toggle.sidebar.complete", function ( event ) {
        window.dispatchEvent( new Event( 'resize' ) ); // trigger resize events to allow Plotly plots to resize its plot
    } );
    $( "#container_main_sidebar" ).on( "pin.sidebar.complete", function ( event ) {
        window.dispatchEvent( new Event( 'resize' ) ); // trigger resize events to allow Plotly plots to resize its plot
    } ); 
    $( "#container_main_sidebar" ).on( "pin.sidebar.hidden", function ( event ) {
         button_open_sidebar.style.display = "block";
    } );
    
    // Get the button_open_sidebar:
    button_open_sidebar = document.getElementById( "button_open_sidebar" );


</script>
</body>
</html> 